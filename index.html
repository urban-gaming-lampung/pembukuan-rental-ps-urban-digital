
<!DOCTYPE html>

<html lang="id">
<head>
<style>
body, .card, .subcard, .modal {
  transition: background-color .25s ease, color .25s ease, border-color .25s ease, box-shadow .25s ease;
}

.btn.warn {
  background: #d93025;
  border-color: #a12016;
  color: #fff;
  box-shadow: 0 3px 10px rgba(217,48,37,0.25);
  transition: box-shadow 0.3s ease, transform 0.2s ease;
}
.btn.warn:hover {
  filter: brightness(1.1);
  box-shadow: 0 6px 18px rgba(217,48,37,0.4);
  transform: translateY(-2px);
}

.pill {
  display: flex;
  align-items: center;
  gap: var(--space-1);
  padding: var(--space-1) 10px;
  background: var(--card2);
  border: 1px solid var(--ring);
  border-radius: 999px;
}
.pill select,
.pill input[type="date"],
.pill button {
  height: var(--ctrl-h);
  line-height: var(--ctrl-h);
  padding: 0 10px;
  font-size: 13px;
  border-radius: 6px;
  box-sizing: border-box;
}

:root {
  --bg: #0b1020;
  --text: #e9eef9;
  --muted: #9aa3b2;
  --accent: #6ea8fe;
  --ring: #2a3358;
  --card: #111833;
  --card2: #0e1530;
  --input-bg: #0e1530;
  --btn-bg: #0f1a3d;
  --warn-bg: #2d1f00;
  --warn-ring: #5b3f00;
  --table-border: #232c52;
  --shadow: 0 10px 30px rgba(0,0,0,.25);
  --space-1: 8px;
  --space-2: 12px;
  --space-3: 16px;
  --space-4: 20px;
  --space-5: clamp(32px, 4vw, 40px);
  --ctrl-h: 40px;
  --radius: 12px;
  --font-xs: 12px;
  --font-sm: 14px;
  --font-md: 16px;
  --font-lg: 20px;
  --font-xl: 24px;
  --font-2xl: 32px;
}
</style>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Pembukuan Rental PS - URBAN DIGITAL (Theme Toggle)</title>
<style>
  /* ========= Tema TOKENS ========= */
  



  /* Light Tema overrides */
  [data-theme="light"]{
    --bg:#f6f7fb;
    --text:#0e1325;
    --muted:#55607a;
    --accent:#2557e0;
    --ring:#d3daf0;

    --card:#ffffff;
    --card2:#f1f4fe;
    --input-bg:#ffffff;
    --btn-bg:#e9edfb;
    --warn-bg:#fff3cd;
    --warn-ring:#ffe08a;

    --table-border:#e2e7fb;
    --shadow:0 6px 18px rgba(0,0,0,.08);
  }

  /* ========= BASE ========= */
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Segoe UI,Roboto,Arial,ui-sans-serif;background:var(--bg);color:var(--text);transition:background .25s ease,color .25s ease}
  .container{max-width:1100px;margin:24px auto;padding:0 16px}

  .header{display:flex;align-items:center;justify-content:space-between;gap: var(--space-2)}
/* Keep the top header visible while scrolling */
.header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: var(--bg);
  padding: var(--space-2) var(--space-3);
  border-bottom: 1px solid var(--ring);
  backdrop-filter: saturate(120%) blur(4px);
}


  .card{background:var(--card);border:1px solid var(--ring);border-radius: calc(var(--radius) * 2);box-shadow:var(--shadow)}
  .pad{padding: var(--space-3)}
  .grid{display:grid;gap: var(--space-2)}
  .g3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }

  label{font-size:12px;color:var(--muted);display:block;margin:0 0 6px}
  input,select,button,textarea{font:inherit}

  .input,.select{width:100%;padding: var(--space-2);border-radius: var(--radius);border:1px solid var(--ring);background:var(--input-bg);color:var(--text);outline:none;transition:background .2s ease,border-color .2s ease}
  .btn{border:1px solid var(--ring);background:var(--btn-bg);color:var(--text);padding: var(--space-2) 14px;border-radius: var(--radius);cursor:pointer;transition:filter .15s ease,opacity .15s ease}
  .btn:hover{filter:brightness(1.05)}
  .btn.primary{border-color:transparent;background:var(--accent);color:#fff}
  

  .row{display:flex;gap: var(--space-2);flex-wrap:wrap;align-items:center}
  
  th,td{padding: var(--space-2); vertical-align: middle;}
  th:first-child,td:first-child{text-align:left}
  th{color:var(--muted);font-size:13px}
  .mono{font-variant-numeric:tabular-nums}
  .right{text-align:right}
  .note{color:var(--muted);font-size:12px}
  .subtle{color:var(--muted)}
  .mini{font-size:12px}
  .table-sm th,.table-sm td{padding: var(--space-1) var(--space-2);}
  .total-row td{font-weight:800;border-top:2px solid var(--ring);border-bottom:none}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--card2);border:1px solid var(--ring);font-size:12px}

  /* Section card variants that previously used hardcoded colors */
  .subcard{background:var(--card2);border:1px solid var(--ring);border-radius: calc(var(--radius) * 2)}
  .subcard .pad{padding: var(--space-3)}

  /* Range pill spacing */
  #rangePill { gap:8px }
  #rangePill .input { padding: var(--space-1) 10px }
  #rangePill .btn { padding:8px 10px }

  /* === Recap styles === */
  .recap{display:grid;gap: var(--space-2);grid-template-columns:repeat(4,minmax(0,1fr));margin:6px 0 0}
  .recap-item{display:flex;align-items:center;gap: var(--space-2);background:var(--card2);border:1px solid var(--ring);border-radius: var(--radius);padding: var(--space-2)}
  .recap-item .label{font-size:12px;color:var(--muted)}
  .recap-item .value{font-weight:800;font-variant-numeric:tabular-nums}
  @media(max-width:900px){.recap{grid-template-columns:repeat(2,minmax(0,1fr))}}
  @media(max-width:600px){.recap{grid-template-columns:1fr}}


/* === Kustom red warning buttons === */




/* === Filter bar consistency === */











/* Force all controls inside pill to be equal height */


/* Make date picker icon vertically aligned */



/* ===== Jendela Dialog ===== */
.modal-backdrop{
  position:fixed; inset:0; background:rgba(0,0,0,.55); backdrop-filter:saturate(120%) blur(2px);
  z-index:9998;
}
.modal{
  position:fixed; inset:0; display:grid; place-items:center; z-index:9999;
}
.modal[hidden], .modal-backdrop[hidden]{ display:none !important; }

.modal > *{
  width:min(560px, calc(100% - 32px));
  background:var(--card);
  color:var(--text);
  border:1px solid var(--ring);
  border-radius: calc(var(--radius) * 2);
  box-shadow:var(--shadow);
}

.modal-header{
  display:flex; align-items:center; justify-content:space-between; gap: var(--space-2);
  padding: var(--space-2) 16px; border-bottom:1px solid var(--ring);
}
.modal-title{ font-weight:800; font-size:16px; }
.modal-close{
  background:transparent; border:1px solid var(--ring); color:var(--text);
  border-radius: var(--radius); padding: var(--space-1) 10px; cursor:pointer;
}

.modal-body{ padding: var(--space-3); font-size:14px; }
.modal-footer{
  padding: var(--space-2) 16px; display:flex; gap: var(--space-2); justify-content:flex-end; border-top:1px solid var(--ring);
}

/* ===== Jendela Dialog Animations ===== */
.modal-backdrop{
  opacity: 0;
  transition: opacity .18s ease-out;
}
.modal-backdrop.is-visible{
  opacity: 1;
}

/* Panel animasi: muncul naik sedikit + fade */
.modal > *{
  transform: translateY(8px) scale(.98);
  opacity: 0;
  transition: transform .22s ease-out, opacity .22s ease-out, box-shadow .22s ease-out;
}
.modal.is-visible > *{
  transform: none;
  opacity: 1;
}


  /* === Form action Baris (Tambah / Cancel) === */
  .actions-row{display:flex;gap: var(--space-2);width:100%;justify-content:flex-end}
  .actions-row.editing{justify-content:space-between}
  .actions-row .btn{min-width:120px}
  .actions-row.editing .btn{flex:1;max-width:220px}
  #cancelEditBtn{order:0}
  #addBtn{order:1}


  .actions-row.editing #cancelEditBtn {
    flex: 0 0 auto;
    max-width: none;
    padding: 0 16px;
  }


/* === Harian Grafik styles === */
.graph-tooltip {
  position: absolute;
  pointer-events: none;
  font-size: 12px;
  background: var(--card2);
  color: var(--text);
  border: 1px solid var(--ring);
  border-radius: 8px;
  padding: var(--space-1) 8px;
  box-shadow: var(--shadow);
  transform: translate(-50%, -120%);
  white-space: nowrap;
  z-index: 10;
}
#graphCard.pulse {
  box-shadow: 0 0 0 0 rgba(110,168,254,.8);
  animation: pulseCard 1.2s ease-out 2;
}
@keyframes pulseCard {
  0% { box-shadow: 0 0 0 0 rgba(110,168,254,.7); }
  100% { box-shadow: 0 0 0 18px rgba(110,168,254,0); }
}

/* === Compact spacing for Grafik === */
#graphCard {
  padding: 8px 12px !important;
}
#graphCard .mini.subtle {
  font-size: 11px !important;
}
/* === Fix Harga column in Jasa & Aksesoris Tabel === */
#jasaTable2x5 td:last-child,
#jasaTable2x5 th:last-child {
  min-width: 100px;
  text-align: right;
}

/* Keep other tables unaffected */
/* === Exact proportions for Jasa & Aksesoris Tabel === */
#jasaTable2x5{
  table-layout: fixed;
  width: 100%;
}
#jasaTable2x5 th, #jasaTable2x5 td{
  vertical-align: middle;
}
#jasaTable2x5 td:nth-child(4), #jasaTable2x5 th:nth-child(4){
  text-align: right;
}
#jasaTable2x5 input.jasa-price{
  text-align: right;
  width: 100%;
  padding-right: 8px;
}
#jasaTable2x5 .jasa-note{
  width: 100%;
}
#jasaTable2x5 .jasa-type{
  width: 100%;
}

/* === Harga input left aligned === */
#jasaTable2x5 input.jasa-price{
  text-align: left !important;
}

/* === Right-aligned helper for notes === */
.auto-note{ margin-left:auto; text-align:left;  white-space:nowrap;}
/** Footer rows alignment for new totals **/
#table tfoot .total-row td:first-child{ text-align:left; }

/* === Filter Card (square-rounded, precise) === */
.filter-card{ border-radius: calc(var(--radius) * 2); background:var(--card2); border:1px solid var(--ring); }
.filter-grid{ display:grid; grid-template-columns: 140px 1fr; gap: var(--space-2) 16px; align-items:center; }
.filter-grid .f-row{ display:contents; } /* allow label + control align on same Baris */
.filter-grid label{ font-size:14px; color:var(--muted); font-weight:600; }
.filter-card .select, .filter-card .input{ height: var(--ctrl-h); border-radius: var(--radius); }
.filter-card .range-wrap .sep{ color:var(--muted); min-width:24px; text-align:center; }
@media (max-width: 700px){
  .filter-grid{ grid-template-columns: 1fr; }
  .filter-grid label{ margin-bottom:4px; }
  .filter-card .range-wrap{ gap:8px; }
  .filter-card .range-wrap .input{ flex:1 1 160px; min-width:0; }
  .filter-card .btn{ flex:1 1 auto; }
  .filter-card .sep{ order:2; } /* keep natural reading on wrap */
}


.g2 { 
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: var(--space-2);
}

/* Responsif */
@media (max-width: 900px) {
  .g2 { grid-template-columns: 1fr; }
  .g4 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
}

.g2 { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap: var(--space-2); }

/* === Responsive Typography (8pt Grid System) === */


/* Base text */
body {
  font-size: var(--font-md);
  line-height: 1.5;
}

/* Titles */
.title {
  font-size: var(--font-xl);
  font-weight: 800;
  line-height: 1.3;
}

/* Tabel text */
th, td {
  font-size: var(--font-sm);
}

/* Small labels and notes */
label, .mini, .note, .subtle {
  font-size: var(--font-xs);
}

/* Responsive adjustments */
@media (max-width: 900px) {
  body { font-size: var(--font-sm); }
}
@media (max-width: 600px) {
  body { font-size: var(--font-sm); } /* mobile-friendly */
  .subtitle { font-size: var(--font-xs); }
}


/* === Fluid Typography & Spacing (8pt Grid System with clamp) === */


/* Typography */
body { font-size: clamp(14px, 1.6vw, 16px); line-height: 1.5; }
.title { font-size: clamp(20px, 3vw, 32px); font-weight: 800; line-height: 1.3; }
.subtitle { font-size: clamp(12px, 1.4vw, 16px); }
th, td { font-size: clamp(12px, 1.4vw, 14px); }
label, .mini, .note, .subtle { font-size: clamp(11px, 1.2vw, 12px); }

/* Buttons & Inputs */
.input, .select, .btn, textarea {
  min-height: var(--ctrl-h);
  border-radius: var(--radius);
  padding: 0 var(--space-2);
  font-size: inherit;
}

/* Card & Grid Spacing */
.card .pad, .subcard .pad { padding: var(--space-3); }
.grid, .row { gap: var(--space-2); }
.spacer { height: var(--space-3); }

/* Tabel padding */
th, td { padding: var(--space-2); vertical-align: middle; }
.table-sm th, .table-sm td { padding: var(--space-1) var(--space-2); }

/* Grafik fix (aspect ratio, responsive) */
#graphCard canvas { width: 100% !important; height: auto !important; aspect-ratio: 16 / 6; }


/* === Fix: Konsistensi & Simetris kolom "No." di semua tabel rincian === */
#rincianTable th:first-child, #rincianTable td:first-child,
#jajananTable3x10 th:first-child, #jajananTable3x10 td:first-child,
#jasaTable2x5 th:first-child, #jasaTable2x5 td:first-child,
#sewaTable3x10 th:first-child, #sewaTable3x10 td:first-child {
  box-sizing: border-box;
  width: 32px;
  min-width: 32px;
  max-width: 32px;
  text-align: center;
  padding-left: 0;
  padding-right: 0;
}

/* === Kustom Bulan UI Polishing (0818) === */
#customMonthRow label{
  font-size:13px;
  color:var(--muted);
  font-weight:600;
  margin-bottom:6px;
  display:block;
}
#customMonthRow .row{align-items:center;}
#customMonthRow .input,#customMonthRow .btn{
  height:var(--ctrl-h);
  border-radius:var(--radius);
}
/* === Kustom Bulan Baris Alignment (0818b) === */
#customMonthRow .row {
  display: flex;
  flex-wrap: nowrap;
  align-items: center;
  gap: var(--space-2);
}
#customMonthRow .input {
  flex: 1 1 auto;
  min-width: 180px;
}
#customMonthRow .btn {
  flex: 0 0 auto;
}

.g2-fixed {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: var(--space-2);
}


/* === Grafik Legend Styles === */
#graphLegend {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 12px 20px;
  font-size: 12px;
}
#graphLegend .legend-item {
  display: flex;
  align-items: center;
  gap: 6px;
}
#graphLegend .legend-color {
  width: 14px;
  height: 14px;
  border-radius: 4px;
  flex-shrink: 0;
}


/* === Grafik Rendah === */
body[data-quality="rendah"] * {
  animation: none !important;
  transition: none !important;
  box-shadow: none !important;
}


/* === Grafik Rendah (mirip tema ringan) === */
body[data-quality="rendah"] {
  --glow-strength: 0;
  --glow-size: 0px;
  --glow-opacity: 0;
  --btn-glow-strength: 0;
  --btn-glow-size: 0px;
  --btn-glow-opacity: 0;
  --anim-speed: 0s;
  --transition-speed: 0s;
  --scale-hover: 1;
  --shadow: none;
}

/* === Grafik Tinggi (default penuh efek) === */
body[data-quality="tinggi"] {
  --shadow: 0 10px 30px rgba(0,0,0,.25);
  --anim-speed: .25s;
}

/* Gunakan variabel animasi di elemen utama */

/* === Setting rows aligned & tidy === */
.setting-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 12px;
}

.setting-row span {
  font-size: 14px;
  line-height: 1.2;
}

.setting-btn {
  min-width: 120px;
  text-align: center;
  padding: 8px 14px;
  border-radius: 12px;
}

html, body {
  max-width: 100%;
  overflow-x: hidden;
}

</style>
<style>
/* === UI Polishing: consistent proportions & spacing === */


/* normalize gaps */
.row{ gap: var(--space-2) !important; }
.grid{ gap: var(--space-2) !important; }
.spacer{ height: var(--space-3) !important; }

/* cards & subcards padding symmetry */
.card .pad, .subcard .pad{ padding: var(--space-3) !important; }
.card, .subcard{ border-radius: calc(var(--radius) * 2) !important; }

/* controls: same height/padding/radius */
.input, .select, .btn, textarea{
  min-height: var(--ctrl-h);
  border-radius: var(--radius);
  padding-top: 8px; padding-bottom: 8px;
}
textarea{ padding-top: 10px; padding-bottom: 10px; }

/* pills: ensure same inner heights and spacing */

th, td{ vertical-align: middle; }
th:first-child, td:first-child{ text-align: left; }

/* top form: keep clean spacing & alignment */
.container .card .grid > div label{ margin-bottom: 6px !important; }
.container .card .grid input.input{ width: 100%; }

/* action Baris: same spacing left-right when editing */
.actions-row{ gap: var(--space-2) !important; }
.actions-row.editing{ justify-content: space-between !important; }
#cancelEditBtn{ margin-right: auto; } /* keep "Batal" on the left */

/* ensure Grafik & footer spacing is even */
#graphCard{ margin-top: var(--space-3); }
#graphCard + div{ margin-top: var(--space-3) !important; } /* footer wrapper */

/* Jasa & Aksesoris proportions (already set via colgroup) + clean inputs */
#jasaTable2x5 input.jasa-price{ text-align: left !important; }
#jasaTable2x5 colgroup col:nth-child(2),
#jasaTable2x5 colgroup col:nth-child(3),
#jasaTable2x5 colgroup col:nth-child(4){ width:31.6% !important; }

/* prevent layout jump on inputs (tabular) */
.mono{ font-variant-numeric: tabular-nums; }

/* responsive: stack cleanly on small screens */
@media(max-width:900px){
  .header{ align-items: flex-start; }
}
@media(max-width:600px){
  .row{ gap: var(--space-1) !important; }
  .btn{ min-width: auto; }
}
</style>
<style>
/* ===== Mobile polish (safe, symmetric, no-left-stretch) ===== */
html, body { overflow-x: hidden; }

/* Safe-area padding for phones with notches + equal side padding */
.container{
  padding-left: max(16px, env(safe-area-inset-left));
  padding-right: max(16px, env(safe-area-inset-right));
}

/* Header buttons wrap neatly */
.header{ flex-wrap: wrap; gap: 8px; }

/* Top form grid: 5 -> 2 -> 1 columns responsively */
.g5{ grid-template-columns: repeat(5, minmax(0, 1fr)); }
@media (max-width: 900px){
  .g5{ grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .title{ font-size: 22px; line-height: 1.2; }
  .header .row{ width: 100%; margin-left: 0; justify-content: flex-start; }
}

/* Make pills/filters not stretch awkwardly on mobile */

}

/* Smooth scrolling for in-app navigation */
html { scroll-behavior: smooth; }

/* === Merged Filter + Rentang pill === */



/* Make the merged pill full-width on small screens for symmetry */
@media (max-width: 600px){
  
}


/* === Toolbar polish: consistent heights & tidy wrap === */
.toolbar-row{
  display:flex;
  flex-wrap:wrap;
  gap: var(--space-2);
  align-items:center;
}
.toolbar-row 
/* Metric pill (for totals) */



/* Keep danger Tombol aligned in the pill */


/* Responsive: make items fill nicely on small screens */
@media (max-width: 900px){
  .toolbar-row > *{ flex:1 1 auto; }
}
@media (max-width: 600px){
  .toolbar-row 
}


/* === Catatan & Tombol precise alignment === */
.catatan-row {
  display: flex;
  gap: var(--space-2);
  align-items: flex-end;
}

.catatan-wrap {
  flex: 1; /* Catatan takes all free space */
}

@media (max-width: 600px) {
  .catatan-row {
    flex-direction: column;
    align-items: stretch;
  }
  .actions-wrap {
    width: 100%;
  }
  #formActions {
    justify-content: flex-start;
  }
}
</style>
<style>
#jajananSettingsModal .modal-body {
  max-height: 80vh;
  overflow-y: auto;
}
#jajananSettingsModal table {
  width: 100%;
  border-collapse: collapse;
}
#jajananSettingsModal th, #jajananSettingsModal td {
  padding: var(--space-1);
  border-bottom: 1px solid var(--ring);
}
</style>
<style>
#popupBackdrop {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    opacity: 0;
    transition: opacity 0.2s ease-in-out;
    z-index: 1000;
}
#popupBackdrop.is-visible {
    opacity: 1;
}
.modal {
    z-index: 1001;
}
</style>
<style>
.settings-sidebar .btn {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: var(--space-2);
    width: 100%;
    text-align: left;
    padding: var(--space-2) 18px;
    border: 2px solid var(--ring);
    border-radius: 8px;
    background: var(--card2);
    font-size: 14px;
    white-space: nowrap;
    transition: background 0.2s, color 0.2s;
}
.settings-sidebar .btn span.emoji {
    flex-shrink: 0;
    font-size: 18px;
    line-height: 1;
}
.settings-sidebar .btn:hover {
    background: var(--hover);
}
.settings-sidebar .btn.active {
    background: #1C308A;
    color: #fff;
    border-color: #1C308A;
}
</style>
<style>
  /* Header tetap tengah */
  table th {
    text-align: center !important;
  }

  /* Default isi tabel kiri */
  table td {
    text-align: left !important;
  }

  /* Angka uang kanan */
  table td.mono,
  table td.right,
  #rincianTotal, #jajananTotal3x10, #jasaTotal2x5, #sewaTotal3x10,
  #recapBar .value, #grandTotal,
  #sumHarian, #sumJajanan, #sumJasa, #sumSewa, #sumTotal, #sumMonth, #sumAll {
    text-align: right !important;
  }

</style>
<style>
  /* Pastikan baris Total rapih dan simetris */
  .total-row td {
    font-weight: 800;
  }
  .total-row td[colspan] {
    text-align: left !important;
  }
  .total-row td.mono {
    text-align: right !important;
    min-width: 120px; /* jaga konsistensi lebar kolom harga */
  }
</style>
<style>
/* === Semua tab dalam Pengaturan fix height 400px === */
.settings-tab {
  height: 400px;
  overflow-y: auto;
}
</style>
<style>
@media (max-width: 600px) {
  .range-wrap .sep {
    display: none !important;
  }
}

/* === Modern UI Enhancements (Kustom Injected) === */

/* Card shadow + hover lift */
.card, .subcard {
  box-shadow: 0 4px 12px rgba(0,0,0,.12), 0 1px 4px rgba(0,0,0,.08);
  transition: all 0.25s ease;
}
.card:hover, .subcard:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 18px rgba(0,0,0,.16);
}

/* Tombol micro animation */
.btn {
  transition: all .2s ease;
}
.btn:hover {
  transform: translateY(-1px) scale(1.02);
}
.btn:active {
  transform: translateY(1px) scale(0.96);
}

/* Recap items animation */
.recap-item {
  animation: fadeUp .4s ease both;
}
@keyframes fadeUp {
  from { opacity:0; transform: translateY(8px); }
  to   { opacity:1; transform: translateY(0); }
}

/* Focus glow on input */
.input:focus, .select:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(110,168,254,0.35);
  transition: all .2s ease;
}

/* Smooth Tema transition */


/* Rounded buttons & gradient primary */

.btn.primary {
  background: linear-gradient(135deg, #6ea8fe, #2557e0);
  box-shadow: 0 4px 10px rgba(37,87,224,.3);
  border: none;
}

/* === Soft Shadow pada input penting (lebih lembut) === */
#date, #day, #absenPagi, #absenSiang, #rukoBuka, #rukoTutup, #catatan {
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  transition: box-shadow 0.3s ease;
}
#date:focus, #day:focus, #absenPagi:focus, #absenSiang:focus, 
#rukoBuka:focus, #rukoTutup:focus, #catatan:focus {
  box-shadow: 0 8px 20px rgba(110,168,254,0.25);
}

/* === Soft Shadow pada tombol utama (Tema, Download Laporan, Pengaturan) === */
#themeBtn, #exportReportBtn, #settingsBtn {
  box-shadow: 0 6px 16px rgba(0,0,0,0.08);
  transition: box-shadow 0.3s ease, transform 0.2s ease;
}
#themeBtn:hover, #exportReportBtn:hover, #settingsBtn:hover {
  box-shadow: 0 8px 20px rgba(110,168,254,0.25);
  transform: translateY(-2px);
}

/* Toolbar tombol kanan (desktop) */
.header .toolbar-row {
  margin-left: auto;
}
@media(max-width: 900px){
  .header .toolbar-row {
    margin-left: 0;
    width: 100%;
    justify-content: flex-start;
  }
}



/* === Default glow + Hover glow + Shake for warn buttons === */


@keyframes shake {
  0% { transform: translateX(0); }
  20% { transform: translateX(-3px); }
  40% { transform: translateX(3px); }
  60% { transform: translateX(-2px); }
  80% { transform: translateX(2px); }
  100% { transform: translateX(0); }
}


</style>
<style>
.settings-layout { display:flex; gap:16px; min-height: var(--ctrl-h); }
.settings-sidebar .btn { justify-content:flex-start; }
.settings-content { flex:1; display:flex; flex-direction:column; gap: var(--space-2); }
.settings-tab[hidden] { display:none !important; }
@media(max-width:600px){
  .settings-layout { flex-direction:column; }
  .settings-sidebar { flex:0 0 auto; }
}

/* === UX ENHANCEMENTS === */
/* Hover & Active Buttons */
.btn {
  transition: transform 0.15s ease, filter 0.15s ease, background-color 0.25s ease;
}
.btn:hover {
  filter: brightness(1.05);
  transform: translateY(-1px);
}
.btn:active {
  transform: translateY(1px) scale(0.98);
}

/* Hover Baris on Tabel */
table tbody tr {
  transition: background-color 0.2s ease;
}
table tbody tr:hover {
  background-color: rgba(110,168,254,0.08);
}

/* Sticky header for scrollable tables */
table thead th {
  position: sticky;
  top: 0;
  background: var(--card);
  z-index: 2;
}

/* Smooth Tema transition */


/* Jendela Dialog open animation */
.modal > * {
  opacity: 0;
  transform: translateY(10px) scale(0.98);
  transition: opacity 0.25s ease, transform 0.25s ease;
}
.modal.is-visible > * {
  opacity: 1;
  transform: translateY(0) scale(1);
}


/* Focus-visible styles for accessibility */
button:focus-visible,
.btn:focus-visible,
input:focus-visible,
select:focus-visible,
textarea:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
  box-shadow: 0 0 0 3px rgba(110,168,254,0.5);
}


/* === Riwayat Tabel UI Polishing === */
#table {
  width: 100%;
  border-collapse: collapse;
}
#table th, #table td {
  padding: var(--space-2) 12px;
  vertical-align: middle;
}
#table th {
  color: var(--muted);
  font-size: 13px;
  background: var(--card2);
}
#table tbody tr:hover {
  background-color: rgba(110, 168, 254, 0.08);
}
/* Tombol Edit dan Hapus */
#table .btn {
  padding: var(--space-1) 10px;
  font-size: 12px;
  border-radius: 8px;
  min-width: 50px;
}
#table 
#table 
/* Responsif */
@media (max-width: 600px) {
  #table th, #table td {
    padding: 8px 6px;
    font-size: 12px;
  }
  #table .btn {
    padding: 4px 8px;
    font-size: 11px;
  }
}

/* === Rentang Filter Alignment === */
.range-wrap {
  display: flex;
  align-items: center;
  gap: 8px;
  flex-wrap: nowrap;
}
.range-wrap input[type="date"] {
  flex: 1 1 auto;
  min-width: 150px;
}
.range-wrap .sep {
  flex: 0 0 auto;
  text-align: center;
  min-width: 24px;
  color: var(--muted);
}
.range-wrap button {
  flex: 0 0 auto;
  min-width: 90px;
}

/* === Responsive Fix Rentang Filter === */
@media (max-width: 600px) {
  .range-wrap {
    flex-wrap: wrap;
    gap: 6px;
  }
  .range-wrap input[type="date"] {
    flex: 1 1 100%;
    min-width: 100%;
  }
  .range-wrap .sep {
    flex: 0 0 100%;
    text-align: center;
    margin: 0;
  }
  .range-wrap button {
    flex: 1 1 auto;
    min-width: 48%;
  }
}
</style>
<style>
/* === CARD Frosted Glass Effect (Dark Theme Only) === */
html:not([data-theme="light"]) .card,
html:not([data-theme="light"]) .card-body {
  background: rgba(30, 30, 30, 0.55); /* abu-abu gelap semi transparan */
  border-radius: 16px;
  backdrop-filter: blur(12px) saturate(160%);
  -webkit-backdrop-filter: blur(12px) saturate(160%);
  border: 1px solid rgba(255, 255, 255, 0.1); /* garis halus */
}

</style>
<style>
/* === CUSTOM BACKGROUND FIX (FIXED VERSION) === */
/* Dark theme: only when html has no data-theme="light" */
html:not([data-theme="light"]) body {
  background-image:
    linear-gradient(rgba(11, 16, 32, 0.65), rgba(11, 16, 32, 0.65)),
    url('bg_dark.jpg');
  background-repeat: no-repeat;
  background-attachment: fixed;
  background-size: cover;
  background-position: center;
}
html[data-theme="light"] body {
  background: var(--bg);
  background-image: none;
}
html[data-theme="light"] body::before {
  content: none;
}
</style>
<style>
/* === Neon Pink Glow Smooth + Pulse Lambat untuk Tombol Utama di Dark Theme === */
html:not([data-theme="light"]) #themeBtn,
html:not([data-theme="light"]) #exportReportBtn,
html:not([data-theme="light"]) #settingsBtn {
  transition: box-shadow 0.35s ease, transform 0.25s ease;
}

html:not([data-theme="light"]) #themeBtn:hover,
html:not([data-theme="light"]) #exportReportBtn:hover,
html:not([data-theme="light"]) #settingsBtn:hover {
  box-shadow: 
    0 0 8px rgba(255, 20, 147, 0.7),
    0 0 16px rgba(255, 20, 147, 0.6),
    0 0 32px rgba(255, 20, 147, 0.5),
    0 0 48px rgba(255, 20, 147, 0.3);
  transform: translateY(-2px);
  animation: neonPulse 3s infinite alternate ease-in-out;
}
</style>
<style>
/* === Neon Pink Glow untuk Input Tanggal & Absen (Dark Theme) === */
html:not([data-theme="light"]) .btn.absen:focus,
html:not([data-theme="light"]) .btn.absen:hover {
  box-shadow: 
    0 0 8px rgba(255, 20, 147, 0.7),
    0 0 16px rgba(255, 20, 147, 0.6),
    0 0 32px rgba(255, 20, 147, 0.5),
    0 0 48px rgba(255, 20, 147, 0.3);
  animation: neonPulse 3s infinite alternate ease-in-out;
}
</style>
<style>
/* === Neon Pink Glow untuk Absen & Ruko Buttons (Dark Theme) === */
html:not([data-theme="light"]) #absenPagiBtn:hover,
html:not([data-theme="light"]) #absenSiangBtn:hover,
html:not([data-theme="light"]) #rukoBukaBtn:hover,
html:not([data-theme="light"]) #rukoTutupBtn:hover,
html:not([data-theme="light"]) #absenPagiBtn:focus,
html:not([data-theme="light"]) #absenSiangBtn:focus,
html:not([data-theme="light"]) #rukoBukaBtn:focus,
html:not([data-theme="light"]) #rukoTutupBtn:focus {
  box-shadow: 
    0 0 8px rgba(255, 20, 147, 0.7),
    0 0 16px rgba(255, 20, 147, 0.6),
    0 0 32px rgba(255, 20, 147, 0.5),
    0 0 48px rgba(255, 20, 147, 0.3);
  animation: neonPulse 3s infinite alternate ease-in-out;
}
</style>
<style>
/* === Neon Pink Glow Dark Theme (Full) === */
html:not([data-theme="light"]) #themeBtn,
html:not([data-theme="light"]) #exportReportBtn,
html:not([data-theme="light"]) #settingsBtn,
html:not([data-theme="light"]) #absenPagiBtn,
html:not([data-theme="light"]) #absenSiangBtn,
html:not([data-theme="light"]) #rukoBukaBtn,
html:not([data-theme="light"]) #rukoTutupBtn,
html:not([data-theme="light"]) .btn.absen,
html:not([data-theme="light"]) input[type="date"],
html:not([data-theme="light"]) input[type="time"],
html:not([data-theme="light"]) input[type="text"],
html:not([data-theme="light"]) select,
html:not([data-theme="light"]) textarea {
  transition: box-shadow 0.35s ease, transform 0.25s ease;
}

/* Hover & Focus states with Neon Pink Glow */
html:not([data-theme="light"]) #themeBtn:hover,
html:not([data-theme="light"]) #exportReportBtn:hover,
html:not([data-theme="light"]) #settingsBtn:hover,
html:not([data-theme="light"]) #absenPagiBtn:hover,
html:not([data-theme="light"]) #absenSiangBtn:hover,
html:not([data-theme="light"]) #rukoBukaBtn:hover,
html:not([data-theme="light"]) #rukoTutupBtn:hover,
html:not([data-theme="light"]) .btn.absen:hover,
html:not([data-theme="light"]) input[type="date"]:focus,
html:not([data-theme="light"]) input[type="time"]:focus,
html:not([data-theme="light"]) input[type="text"]:focus,
html:not([data-theme="light"]) textarea:focus,
html:not([data-theme="light"]) #absenPagiBtn:focus,
html:not([data-theme="light"]) #absenSiangBtn:focus,
html:not([data-theme="light"]) #rukoBukaBtn:focus,
html:not([data-theme="light"]) #rukoTutupBtn:focus {
  box-shadow: 
    0 0 8px rgba(255, 20, 147, 0.7),
    0 0 16px rgba(255, 20, 147, 0.6),
    0 0 32px rgba(255, 20, 147, 0.5),
    0 0 48px rgba(255, 20, 147, 0.3);
  transform: translateY(-2px);
  animation: neonPulse 3s infinite alternate ease-in-out;
}
</style>
<style>
/* === Neon Pink Glow Dark Theme (Universal Inputs & Buttons) === */
html:not([data-theme="light"]) #themeBtn,
html:not([data-theme="light"]) #exportReportBtn,
html:not([data-theme="light"]) #settingsBtn,
html:not([data-theme="light"]) #absenPagiBtn,
html:not([data-theme="light"]) #absenSiangBtn,
html:not([data-theme="light"]) #rukoBukaBtn,
html:not([data-theme="light"]) #rukoTutupBtn,
html:not([data-theme="light"]) .btn,
html:not([data-theme="light"]) input,
html:not([data-theme="light"]) select,
html:not([data-theme="light"]) textarea {
  transition: box-shadow 0.35s ease, transform 0.25s ease;
}

/* Hover & Focus states with Neon Pink Glow */
html:not([data-theme="light"]) #themeBtn:hover,
html:not([data-theme="light"]) #exportReportBtn:hover,
html:not([data-theme="light"]) #settingsBtn:hover,
html:not([data-theme="light"]) #absenPagiBtn:hover,
html:not([data-theme="light"]) #absenSiangBtn:hover,
html:not([data-theme="light"]) #rukoBukaBtn:hover,
html:not([data-theme="light"]) #rukoTutupBtn:hover,
html:not([data-theme="light"]) .btn:hover,
html:not([data-theme="light"]) input:focus,
html:not([data-theme="light"]) select:focus,
html:not([data-theme="light"]) textarea:focus {
  outline: none;
  box-shadow: 
    0 0 8px rgba(255, 20, 147, 0.7),
    0 0 16px rgba(255, 20, 147, 0.6),
    0 0 32px rgba(255, 20, 147, 0.5),
    0 0 48px rgba(255, 20, 147, 0.3);
  transform: translateY(-2px);
  animation: neonPulse 3s infinite alternate ease-in-out;
}

/* Pulse animation */
@keyframes neonPulse {
  0% {
    box-shadow: 
      0 0 6px rgba(255, 20, 147, 0.5),
      0 0 12px rgba(255, 20, 147, 0.4),
      0 0 24px rgba(255, 20, 147, 0.3);
  }
  100% {
    box-shadow: 
      0 0 10px rgba(255, 20, 147, 0.8),
      0 0 24px rgba(255, 20, 147, 0.6),
      0 0 40px rgba(255, 20, 147, 0.5),
      0 0 60px rgba(255, 20, 147, 0.4);
  }
}
</style>
<style>
/* Ikon kalender & jam putih polos di dark theme */
html:not([data-theme="light"]) input[type="date"]::-webkit-calendar-picker-indicator,
html:not([data-theme="light"]) input[type="time"]::-webkit-calendar-picker-indicator {
  filter: invert(1);
  cursor: pointer;

}
</style>
<style !important;="" (prefers-color-scheme:="" (sticky="" *="" +="" --bg-rgb="" --bg-rgb:="" -webkit-backdrop-filter:="" .35rem;="" .5rem="" .5rem;="" .75rem;="" .85;="" .btn="" .emoji="" .header="" .main,="" .subtitle="" .title="" .toolbar-row="" 0="" 0.7)="" 0;="" 1.1em;="" 1.2;="" 1000;="" 18),="" 18,="" 18;="" 1px="" 245,="" 245;="" 24px="" 6px="" 700;="" 72px;="" 999px;="" <="" @media="" add="" align-items:="" always-visible="" backdrop-filter:="" background-color:="" background:="" blur(2px);="" blur(8px)="" body="" border-bottom:="" border-radius:="" border:="" box-shadow:="" center;="" content="" cover="" dark)="" defined="" display:="" doesn't="" fallback="" flex-wrap:="" flex;="" font-weight:="" frosted="" gap:="" header="" height:="" id="topbar-frosted-overrides-OLD" if="" inline-flex;="" it="" left:="" light="" line-height:="" main="" main,="" not="" opacity:="" overrides="" padding="" padding:="" position:="" relative;="" rgb="" rgba(0,0,0,.15);="" rgba(255,255,255,.06);="" rgba(255,255,255,.08))="" rgba(255,255,255,.12));="" rgba(var(--bg-rgb,="" right:="" saturate(140%)="" scroll-padding-top:="" so="" solid="" sticky="" style="" to="" toolbar)="*/" top="" top:="" var(--ring,="" width:="" wrap;="" z-index:="" {="" }="">
<style id="topbar-dark-rounded">

/* === Dark Theme Rounded Frosted Header Bar === */
.header {
  position: sticky !important;
  top: 0 !important;
  left: 0;
  right: 0;
  z-index: 1000;
  backdrop-filter: saturate(160%) blur(10px) !important;
  -webkit-backdrop-filter: saturate(160%) blur(10px) !important;
  background-color: rgba(20, 20, 20, 0.7) !important;
  border-bottom: 1px solid rgba(255,255,255,0.08) !important;
  box-shadow: 0 8px 28px rgba(0,0,0,.35);
  border-radius: 0 0 20px 20px; /* rounded bottom bar */
  margin: 0 auto;
  max-width: 1100px;
}

/* Title & Subtitle contrast in dark mode */
html:not([data-theme="light"]) .header .title {
  color: #ffffff;
  text-shadow: 0 1px 3px rgba(0,0,0,.6);
}
html:not([data-theme="light"]) .header .subtitle {
  color: #d0d0d0;
}

/* Buttons inside header with subtle rounded glow */
.header .btn {
  border-radius: 999px !important;
  background: rgba(255,255,255,0.05);
  border: 1px solid rgba(255,255,255,0.15);
  color: #f5f5f5;
  transition: all 0.25s ease;
}
.header .btn:hover {
  background: rgba(255,255,255,0.12);
  transform: translateY(-1px);
}

/* Add padding to body so content doesn't overlap */
body {
  scroll-padding-top: 80px;
}

</style>
<style id="topbar-dark-fix">

/* === Fix Dark Theme Frosted Header Buttons/Text === */
.header {
  position: sticky !important;
  top: 0 !important;
  left: 0;
  right: 0;
  z-index: 1000;
  backdrop-filter: blur(12px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(12px) saturate(180%) !important;
  background-color: rgba(25, 25, 25, 0.6) !important;
  border-bottom: 1px solid rgba(255,255,255,0.1) !important;
  box-shadow: 0 6px 20px rgba(0,0,0,.4);
  border-radius: 0 0 18px 18px;
  margin: 0 auto;
  max-width: 1200px;
  color: #fff;
}

.header .title {
  color: #fff !important;
  font-weight: 700;
}
.header .subtitle {
  color: #ddd !important;
}

/* Buttons high contrast */
.header .btn {
  border-radius: 999px !important;
  background: rgba(255,255,255,0.15) !important;
  border: 1px solid rgba(255,255,255,0.25) !important;
  color: #fff !important;
  font-weight: 500;
  text-shadow: 0 1px 2px rgba(0,0,0,.8);
  transition: all .25s ease;
}
.header .btn:hover {
  background: rgba(255,255,255,0.25) !important;
  transform: translateY(-1px);
}

/* Emoji icon inside button should stay visible */
.header .btn .emoji {
  filter: drop-shadow(0 1px 1px rgba(0,0,0,.8));
}

</style>
<style id="topbar-auto-theme">

/* === Auto Light/Dark Theme for Header === */

/* Default (light mode) */
.header {
  background-color: rgba(255, 255, 255, 0.7) !important;
  color: #111 !important;
}
.header .title { color: #111 !important; }
.header .subtitle { color: #444 !important; }
.header .btn {
  background: rgba(0,0,0,0.05) !important;
  border: 1px solid rgba(0,0,0,0.15) !important;
  color: #111 !important;
  text-shadow: none !important;
}
.header .btn:hover {
  background: rgba(0,0,0,0.12) !important;
}

/* Dark mode override */
@media (prefers-color-scheme: dark) {
  .header {
    background-color: rgba(25, 25, 25, 0.6) !important;
    color: #fff !important;
  }
  .header .title { color: #fff !important; }
  .header .subtitle { color: #ddd !important; }
  .header .btn {
    background: rgba(255,255,255,0.15) !important;
    border: 1px solid rgba(255,255,255,0.25) !important;
    color: #fff !important;
    text-shadow: 0 1px 2px rgba(0,0,0,.8) !important;
  }
  .header .btn:hover {
    background: rgba(255,255,255,0.25) !important;
  }
}

</style>
<style id="topbar-toggle-theme">

/* === Manual Theme Toggle Support === */

/* Light Theme (default) */
body:not(.dark-theme) .header {
  background-color: rgba(255, 255, 255, 0.7) !important;
  color: #111 !important;
}
body:not(.dark-theme) .header .title { color: #111 !important; }
body:not(.dark-theme) .header .subtitle { color: #444 !important; }
body:not(.dark-theme) .header .btn {
  background: rgba(0,0,0,0.05) !important;
  border: 1px solid rgba(0,0,0,0.15) !important;
  color: #111 !important;
  text-shadow: none !important;
}
body:not(.dark-theme) .header .btn:hover {
  background: rgba(0,0,0,0.12) !important;
}

/* Dark Theme */
body.dark-theme .header {
  background-color: rgba(25, 25, 25, 0.6) !important;
  color: #fff !important;
}
body.dark-theme .header .title { color: #fff !important; }
body.dark-theme .header .subtitle { color: #ddd !important; }
body.dark-theme .header .btn {
  background: rgba(255,255,255,0.15) !important;
  border: 1px solid rgba(255,255,255,0.25) !important;
  color: #fff !important;
  text-shadow: 0 1px 2px rgba(0,0,0,.8) !important;
}
body.dark-theme .header .btn:hover {
  background: rgba(255,255,255,0.25) !important;
}

</style>
<style id="lightmode-soft-shadow">

/* === Softer Shadow for Light Mode === */
body:not(.dark-theme) .header {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
}

</style>
<style id="header-theme-datatheme">
/* Light Theme Header */
html[data-theme="light"] .header {
  background-color: rgba(255,255,255,0.7) !important;
  color: #111 !important;
  border-bottom: 1px solid rgba(0,0,0,0.15) !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
}
html[data-theme="light"] .header .title { color: #111 !important; }
html[data-theme="light"] .header .subtitle { color: #444 !important; }
html[data-theme="light"] .header .btn {
  background: rgba(0,0,0,0.05) !important;
  border: 1px solid rgba(0,0,0,0.15) !important;
  color: #111 !important;
}

/* Dark Theme Header */
html:not([data-theme="light"]) .header {
  background-color: rgba(25,25,25,0.6) !important;
  color: #fff !important;
  border-bottom: 1px solid rgba(255,255,255,0.1) !important;
  box-shadow: 0 8px 28px rgba(0,0,0,.35) !important;
}
html:not([data-theme="light"]) .header .title { color: #fff !important; }
html:not([data-theme="light"]) .header .subtitle { color: #ddd !important; }
html:not([data-theme="light"]) .header .btn {
  background: rgba(255,255,255,0.15) !important;
  border: 1px solid rgba(255,255,255,0.25) !important;
  color: #fff !important;
}
</style>
<style id="header-buttons-darkblue">
/* Light Theme Buttons */
html[data-theme="light"] .header .btn {
  background: rgba(0,0,0,0.05) !important;
  border: 1px solid rgba(0,0,0,0.15) !important;
  color: #111 !important;
}

/* Dark Theme Buttons: Deep Blue */
html:not([data-theme="light"]) .header .btn {
  background: #0d47a1 !important;   /* dark blue */
  border: 1px solid #1565c0 !important;
  color: #fff !important;
  text-shadow: 0 1px 2px rgba(0,0,0,.8) !important;
  transition: background 0.25s ease, transform 0.2s ease;
}
html:not([data-theme="light"]) .header .btn:hover {
  background: #1565c0 !important;   /* lighter blue */
  transform: translateY(-2px);
}
</style>
<style id="header-buttons-darkblue-glow">
/* Dark Theme Buttons: Add Glow */
html:not([data-theme="light"]) .header .btn {
  box-shadow: 0 0 8px rgba(21,101,192,0.6) !important; /* blue glow */
}
html:not([data-theme="light"]) .header .btn:hover {
  box-shadow: 0 0 12px rgba(21,101,192,0.9) !important;
}
</style>
<style id="header-buttons-deepblue-ripple-softer">
/* Ripple effect adjustments */
.header .btn .ripple {
  transform: scale(0);
  animation: ripple-animation-soft 900ms ease-out; /* slower and softer */
  opacity: 0.75;
}
@keyframes ripple-animation-soft {
  to {
    transform: scale(6); /* larger ripple */
    opacity: 0;
  }
}
</style>
<style id="header-buttons-darktheme-frosted">
/* Light Theme Buttons (default) */
html[data-theme="light"] .header .btn {
  background: rgba(0,0,0,0.05) !important;
  border: 1px solid rgba(0,0,0,0.15) !important;
  color: #111 !important;
}

/* Dark Theme Buttons - Deep Dark Blue (#0E1531) with Frosted Glass */
html:not([data-theme="light"]) .header .btn {
  background: rgba(14,21,49,0.65) !important;
  border: 1px solid rgba(255,255,255,0.15) !important;
  color: #fff !important;
  backdrop-filter: blur(8px) saturate(150%) !important;
  -webkit-backdrop-filter: blur(8px) saturate(150%) !important;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  transition: background 0.3s ease, transform 0.2s ease;
}
html:not([data-theme="light"]) .header .btn:hover {
  background: rgba(14,21,49,0.85) !important;
  transform: translateY(-2px);
}
</style>
<style id="header-buttons-darktheme-frosted-strong">
/* Dark Theme Buttons - Force #0E1531 with frosted glass */
html:not([data-theme="light"]) .header .toolbar-row .btn {
  background-color: rgba(14,21,49,0.85) !important; /* #0E1531 solid navy */
  border: 1px solid rgba(255,255,255,0.2) !important;
  color: #ffffff !important;
  backdrop-filter: blur(10px) saturate(180%) !important;
  -webkit-backdrop-filter: blur(10px) saturate(180%) !important;
  box-shadow: 0 4px 16px rgba(0,0,0,0.4) !important;
  transition: all 0.3s ease !important;
}
html:not([data-theme="light"]) .header .toolbar-row .btn:hover {
  background-color: rgba(14,21,49,1) !important; /* darker on hover */
  box-shadow: 0 0 10px rgba(14,21,49,0.7) !important;
  transform: translateY(-2px);
}
</style>
<style>
/* === FIX: Hilangkan text-shadow di tulisan tombol Light Theme === */
html[data-theme="light"] .header .btn {
  text-shadow: none !important;
}
</style>
<style>
/* === Center title & subtitle on mobile (custom inject) === */
@media (max-width: 600px) {
  .header > div {
    text-align: center;
    width: 100%;
  }
  .header .title,
  .header .subtitle {
    text-align: center;
  }
}
</style><style>
/* === Resize toolbar buttons on mobile (custom inject) === */
@media (max-width: 600px) {
  .header .toolbar-row .btn {
    padding: 6px 10px;
    font-size: 12px;
    min-width: auto;
    flex: 1; /* biar ukurannya proporsional */
  }
  .header .toolbar-row {
    gap: 6px;
  }
}
</style><style>
/* === Mobile: toolbar buttons smaller & proportional (option 1) === */
@media (max-width: 600px) {
  .header .toolbar-row {
    gap: 6px;
    justify-content: center;
  }
  .header .toolbar-row .btn {
    flex: 1;
    font-size: 12px;
    padding: 6px 8px;
    min-width: unset;
    max-width: 100px; /* batasi biar seragam */
    text-align: center;
  }
}
</style><style>
/* === Fix Download Laporan button one-line on mobile === */
@media (max-width: 600px) {
  .header .toolbar-row .btn {
    flex: 1;
    font-size: 11px;
    padding: 6px 6px;
    min-width: unset;
    text-align: center;
    white-space: nowrap; /* cegah line break */
  }
  /* khusus tombol Download Laporan lebih lebar */
  #exportReportBtn {
    max-width: 130px;
  }
}
</style><style>
/* === Light theme button pressed effect === */
.light-theme .btn:active,
.light-theme .btn:focus {
  background-color: #ffffff !important; /* putih */
  color: #000000 !important;            /* teks tetap hitam */
  box-shadow: 0 0 5px rgba(0,0,0,0.15); /* efek lembut */
}
</style><style>
/* === Remove default grey tap highlight (#DDDEE0) === */
.btn {
  -webkit-tap-highlight-color: transparent; /* nonaktifkan highlight Android/iOS */
}

.light-theme .btn:active,
.light-theme .btn:focus {
  background-color: #ffffff !important; /* tetap putih */
  color: #000000 !important;
  box-shadow: 0 0 5px rgba(0,0,0,0.15);
}
</style><style>

/* === Custom Header Colors Updated === */

/* === Custom Header Colors for Rincian Tables (Light & Dark Theme) === */

/* Light Theme */
html[data-theme="light"] #rincianTable thead th {
  background-color: #2ecc71 !important; /* hijau terang */
  color: #fff !important;
}
html[data-theme="light"] #jajananTable3x10 thead th {
  background-color: #f1c40f !important; /* kuning */
  color: #000 !important;
}
html[data-theme="light"] #jasaTable2x5 thead th {
  background-color: #e74c3c !important; /* merah terang */
  color: #fff !important;
}
html[data-theme="light"] #sewaTable3x10 thead th {
  background-color: #2980b9 !important; /* biru terang */
  color: #fff !important;
}

/* Dark Theme */
html:not([data-theme="light"]) #rincianTable thead th {
  background-color: #145a32 !important; /* hijau gelap */
  color: #ecf0f1 !important;
}
html:not([data-theme="light"]) #jajananTable3x10 thead th {
  background-color: #b7950b !important; /* emas tua */
  color: #fff !important;
}
html:not([data-theme="light"]) #jasaTable2x5 thead th {
  background-color: #922b21 !important; /* merah gelap */
  color: #fff !important;
}
html:not([data-theme="light"]) #sewaTable3x10 thead th {
  background-color: #154360 !important; /* biru navy */
  color: #ecf0f1 !important;
}

</style>
<style>
@media (max-width:600px) {
  /* Kosongkan Rincian -> ðŸ—‘ï¸ */
  #rincianClear,
  #jajanan3x10Clear,
  #jasa2x5Clear,
  #sewa3x10Clear {
    font-size: 0 !important;
  }
  #rincianClear::after,
  #jajanan3x10Clear::after,
  #jasa2x5Clear::after,
  #sewa3x10Clear::after {
    content: "ðŸ—‘ï¸";
    font-size: 16px;
  }

  /* Tambah Baris -> + Baris */
  #rincianAddRow,
  #jajanan3x10AddRow,
  #jasa2x5AddRow,
  #sewa3x10AddRow {
    font-size: 0 !important;
  }
  #rincianAddRow::after,
  #jajanan3x10AddRow::after,
  #jasa2x5AddRow::after,
  #sewa3x10AddRow::after {
    content: "+ Baris";
    font-size: 14px;
  }

  /* Tombol Hapus Baris -> - Baris (mobile fix) */
@media (max-width:600px){
  .remove-row { font-size:0 !important; }
  .remove-row::after { content:"- Baris"; font-size:14px; }
}

  .remove-row::after,
  
}
</style>
<style>
/* === Mobile: Rapikan tombol Tambah/Hapus Baris & keterangan total === */
@media (max-width:600px){
  /* Tombol Tambah & Hapus Baris lebih kecil & proporsional */
  #rincianAddRow, #jajanan3x10AddRow,
  #jasa2x5AddRow, #sewa3x10AddRow,
  .remove-row {
    flex:1;
    font-size:12px;
    padding:6px 8px;
    min-width:unset;
    max-width:100px;
    text-align:center;
  }

  /* Baris tombol + catatan menjadi wrap */
  .row[style*="margin-top"] {
    flex-wrap:wrap;
    gap:6px;
  }

  /* Keterangan total otomatis pindah ke bawah */
  .row[style*="margin-top"] .auto-note {
    flex:1 1 100%;
    text-align:left;
    font-size:11px;
    margin-top:4px;
  }
}
</style>
<style>
/* === Mobile: Perlebar kolom input/select kecil tanpa stack === */
@media (max-width:600px){
  /* Perlebar input & select di kolom kecil */
  #rincianTable select,
  #jajananTable3x10 select,
  #jasaTable2x5 select,
  #sewaTable3x10 select,
  #rincianTable input,
  #jajananTable3x10 input,
  #jasaTable2x5 input,
  #sewaTable3x10 input {
    min-width: 120px;
    font-size: 13px;
  }

  /* Supaya tabel bisa di-scroll kalau melebar */
  #rincianTable, #jajananTable3x10, #jasaTable2x5, #sewaTable3x10 {
    display: block;
    overflow-x: auto;
    white-space: nowrap;
  }
}
</style>
<style>
/* Fix .pill agar tidak mempengaruhi lebar tabel di desktop */
.pill {
  display: inline-flex;
  flex-wrap: wrap;
  max-width: max-content;
}

/* Pastikan card tidak mengecilkan tabel */
.card {
  width: 100%;
  max-width: none;
}

/* Pastikan tabel tetap full width dan responsif */
table {
  width: 100%;
  border-collapse: collapse;
}
table th, table td {
  padding: 8px;
  text-align: left;
}
@media (min-width: 768px) {
  table {
    font-size: 14px;
  }
}
</style>
<style>
/* Enforce center alignment for first column numbers across all tables */
#rincianTable th:first-child, #rincianTable td:first-child,
#jajananTable3x10 th:first-child, #jajananTable3x10 td:first-child,
#jasaTable2x5 th:first-child, #jasaTable2x5 td:first-child,
#sewaTable3x10 th:first-child, #sewaTable3x10 td:first-child {
  text-align: center !important;
  vertical-align: middle !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}

/* In case cells use flexbox layouts */
#rincianTable td:first-child > *, 
#jajananTable3x10 td:first-child > *, 
#jasaTable2x5 td:first-child > *, 
#sewaTable3x10 td:first-child > * {
  display: inline-block;
  width: 100%;
  text-align: center;
}
</style>
<style>
/* Pastikan tulisan TOTAL pada semua tabel rincian rata kiri */
#rincianTable tfoot .total-row td:first-child,
#jajananTable3x10 tfoot .total-row td:first-child,
#jasaTable2x5 tfoot .total-row td:first-child,
#sewaTable3x10 tfoot .total-row td:first-child {
  text-align: left !important;
}
</style>
<style>
/* === Konsisten spacing recap bar === */
#recapBar {
  margin-top: 16px !important;
}
</style>
<style>
/* === Frosted Glass Effect untuk Semua Modal (Dark Theme Only) === */
html:not([data-theme="light"]) .modal > div {
  background: rgba(25, 25, 25, 0.55) !important;
  border-radius: 16px !important;
  backdrop-filter: blur(14px) saturate(160%) !important;
  -webkit-backdrop-filter: blur(14px) saturate(160%) !important;
  border: 1px solid rgba(255, 255, 255, 0.12) !important;
  box-shadow: 0 8px 32px rgba(0,0,0,0.4) !important;
}
</style>
<style>
/* === UX Enhancements for Recap === */
.recap-item {
  position: relative;
  cursor: pointer;
}
.recap-item:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 120%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--card2);
  color: var(--text);
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 6px;
  box-shadow: var(--shadow);
  white-space: nowrap;
  z-index: 20;
}

/* Highlight update */
.recap-item.updated {
  animation: pulseUpdate 0.8s ease;
}
@keyframes pulseUpdate {
  0% { background-color: rgba(110,168,254,0.2); }
  100% { background-color: var(--card2); }
}
</style><style>
/* === UI Enhancements for Recap === */

/* Highlight khusus untuk Total Semua */
.recap-item.total {
  background: linear-gradient(135deg, #4caf50, #81c784);
  color: #fff !important;
  font-weight: 700;
  font-size: 1.1em;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

/* Responsif Recap */
#recapBar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 12px;
  padding: 12px;
}
@media (max-width: 768px) {
  #recapBar {
    grid-template-columns: repeat(2, 1fr);
  }
}
@media (max-width: 480px) {
  #recapBar {
    grid-template-columns: 1fr;
  }
}
</style></head>
<body>
<div class="container">
<div class="header">
<div>
<div class="title">PEMBUKUAN RENTAL PS â€” URBAN GAMING LAMPUNG DIGITAL</div>
<div class="subtitle">URBAN PlayStation Lampung ðŸŽ®</div>
</div>
<div class="row toolbar-row">
<button class="btn" id="themeBtn" title="Ganti tema"><span class="emoji">ðŸŒ™</span>Gelap</button>
<button class="btn" id="exportReportBtn">ðŸ“ Download Laporan</button>
<button class="btn" id="settingsBtn">âš™ Pengaturan</button>
</div>
</div>
<div class="spacer"></div>
<div class="card pad">
<!-- Row 1: Date & Day -->
<div class="grid g2-fixed top-form">
<div>
<label>Tanggal</label>
<input class="input" id="date" type="date"/>
</div>
<div>
<label>Hari</label>
<input class="input" id="day" readonly="" style="background-color: var(--card2); color: var(--muted);" type="text"/>
</div>
</div>
<!-- Row 2: Absen & Ruko -->
<!-- Row 2: Absen -->
<div class="grid g2-fixed" style="margin-top: var(--space-2);">
<div>
<label>Absen Pagi</label>
<input class="input" id="absenPagi" required="" type="time"/>
</div>
<div>
<label>Absen Siang</label>
<input class="input" id="absenSiang" required="" type="time"/>
</div>
</div>
<!-- Row 3: Ruko -->
<div class="grid g2-fixed" style="margin-top: var(--space-2);">
<div>
<label>Ruko Buka</label>
<input class="input" id="rukoBuka" required="" type="time"/>
</div>
<div>
<label>Ruko Tutup</label>
<input class="input" id="rukoTutup" required="" type="time"/>
</div>
</div>
<!-- Hidden fields -->
<input id="harian" type="hidden" value="0"/>
<input id="jajanan" type="hidden" value="0"/>
<input id="jasa" type="hidden" value="0"/>
<input id="sewa" type="hidden" value="0"/>
<div class="spacer"></div>
<div class="row catatan-row">
<div class="catatan-wrap">
<label>Catatan (opsional)</label>
<input class="input" id="catatan" placeholder="misal : Ada yang belum bayar" type="text"/>
</div>
<div class="actions-wrap">
<label style="visibility:hidden">.</label>
<div class="actions-row" id="formActions">
<button class="btn warn" id="cancelEditBtn" style="display:none;">Batalkan Edit</button>
<button class="btn primary" id="addBtn">+ Tambah Pencatatan</button>
</div>
</div>
</div>
<div class="spacer"></div>
<!-- Rincian Pemasukan Harian -->
<div class="subcard">
<div class="pad">
<div class="row" style="justify-content:space-between;align-items:center">
<div><b>Rincian Pemasukan Harian</b> <span class="badge">10 baris</span></div>
<div class="mini subtle">Kolom: 1) No. 2) Jenis PS 3) Jam Masuk 4) Jumlah Jam 5) Harga</div>
</div>
<div style="overflow:auto;margin-top: var(--space-2)">
<table class="table-sm" id="rincianTable">
<thead>
<tr>
<th>No.</th>
<th>Jenis PS</th>
<th>Jam Masuk</th>
<th>Jumlah Jam</th>
<th>Harga (Rp)</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr class="total-row">
<td class="right" colspan="4">TOTAL</td>
<td class="mono right" id="rincianTotal">Rp 0</td>
</tr>
<tr class="total-row">
<td colspan="9" style="text-align:left; padding-top:8px;">
</td>
</tr>
</tfoot>
</table>
</div>
<div class="row" style="margin-top: var(--space-2)">
<button class="btn" id="rincianClear" type="button">Kosongkan Rincian</button>
<button class="btn primary" id="rincianAddRow" type="button">+ Tambah Baris</button>
<span class="mini subtle auto-note">Total otomatis masuk ke kolom <b>Pemasukan Harian</b>.</span>
</div>
</div>
</div>
<div class="spacer"></div>
<!-- Rincian Pemasukan Jajanan (3 kolom Ã— 10 baris) -->
<div class="subcard">
<div class="pad">
<div class="row" style="justify-content:space-between;align-items:center">
<div><b>Rincian Pemasukan Jajanan</b> <span class="badge">3 kolom Ã— 10 baris</span></div>
<div class="mini subtle">Kolom: 1) Jenis â€¢ 2) Qty &amp; Jam â€¢ 3) Harga (otomatis)</div>
</div>
<div style="overflow:auto;margin-top: var(--space-2)">
<table class="table-sm" id="jajananTable3x10">
<thead>
<tr><th>No.</th><th>Jenis Jajanan</th><th>Qty &amp; Jam</th><th>Harga (Rp)</th></tr>
</thead>
<tbody></tbody>
<tfoot>
<tr class="total-row">
<td class="right" colspan="2">TOTAL</td>
<td></td>
<td class="mono right" id="jajananTotal3x10">Rp 0</td>
</tr>
<tr class="total-row">
<td colspan="9" style="text-align:left; padding-top:8px;">
</td>
</tr>
</tfoot>
</table>
</div>
<div class="row" style="margin-top: var(--space-2)">
<button class="btn" id="jajanan3x10Clear" type="button">Kosongkan Rincian</button>
<button class="btn primary" id="jajanan3x10AddRow" type="button">+ Tambah Baris</button>
<span class="mini subtle auto-note">Total otomatis â†’ kolom <b>Pemasukan Jajanan</b>.</span>
</div>
</div>
</div>
<div class="spacer"></div>
<!-- Rincian Pemasukan Jasa & Aksesoris (3 kolom Ã— 5 baris) -->
<div class="subcard">
<div class="pad">
<div class="row" style="justify-content:space-between;align-items:center">
<div><b>Rincian Pemasukan Jasa &amp; Aksesoris</b> <span class="badge">3 kolom Ã— 5 baris</span></div>
<div class="mini subtle">Kolom: 1) Tipe (drop-down) â€¢ 2) Keterangan (manual) â€¢ 3) Harga (manual)</div>
</div>
<div style="overflow:auto;margin-top: var(--space-2)">
<table class="table-sm" id="jasaTable2x5"><colgroup><col style="width:5.2%"/><col style="width:31.6%"/><col style="width:31.6%"/><col style="width:31.6%"/></colgroup>
<thead><tr><th>No.</th><th>Tipe</th><th>Keterangan</th><th>Harga (Rp)</th></tr></thead>
<tbody></tbody>
<tfoot><tr class="total-row"><td class="right" colspan="3">TOTAL</td><td class="mono right" id="jasaTotal2x5">Rp 0</td></tr>
<tr class="total-row">
<td colspan="9" style="text-align:left; padding-top:8px;">
</td>
</tr>
</tfoot>
</table>
</div>
<div class="row" style="margin-top: var(--space-2)">
<button class="btn" id="jasa2x5Clear" type="button">Kosongkan Rincian</button>
<button class="btn primary" id="jasa2x5AddRow" type="button">+ Tambah Baris</button>
<span class="mini subtle auto-note">Total otomatis â†’ kolom <b>Pemasukan Jasa &amp; Aksesoris</b> di atas.</span>
</div>
</div>
</div>
<div class="spacer"></div>
<!-- Rincian Pemasukan SEWA PS (3 kolom Ã— 10 baris) -->
<div class="subcard">
<div class="pad">
<div class="row" style="justify-content:space-between;align-items:center">
<div><b>Rincian Pemasukan SEWA PS</b> <span class="badge">4 kolom Ã— 5 baris</span></div>
<div class="mini subtle">Kolom: 1) Jenis PS â€¢ 2) Lama Sewa â€¢ 3) Keterangan (opsional) â€¢ 4) Harga (otomatis bisa diedit)</div>
</div>
<div style="overflow:auto;margin-top: var(--space-2)">
<table class="table-sm" id="sewaTable3x10">
<thead>
<tr>
<th>No.</th><th>Jenis PS</th><th>Lama Sewa</th><th>Keterangan</th><th>Harga (Rp)</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr class="total-row">
<td class="right" colspan="4">TOTAL</td>
<td class="mono right" id="sewaTotal3x10">Rp 0</td>
</tr>
<tr class="total-row">
<td colspan="9" style="text-align:left; padding-top:8px;">
</td>
</tr>
</tfoot>
</table>
</div>
<div class="row" style="margin-top: var(--space-2)">
<button class="btn" id="sewa3x10Clear" type="button">Kosongkan Rincian </button>
<button class="btn primary" id="sewa3x10AddRow" type="button">+ Tambah Baris</button>
<span class="mini subtle auto-note">Total otomatis â†’ kolom <b>Sewa PS</b> di atas.</span>
</div>
<!-- Recap ringkas di atas TOTAL KESELURUHAN -->
</div>
</div>
<div class="subcard" id="recapBar">
<div class="pad">
<b>Rekap Pemasukan</b>
<div class="recap-flex">
<div class="recap-item" data-target="#rincianTable" data-tooltip="Detail dari tabel Harian"><span>Pemasukan Harian</span><span id="recapHarian">Rp 0</span></div>
<div class="recap-item" data-target="#jajananTable3x10" data-tooltip="Detail dari tabel Jajanan"><span>Pemasukan Jajanan</span><span id="recapJajanan">Rp 0</span></div>
<div class="recap-item" data-target="#jasaTable2x5" data-tooltip="Detail dari tabel Jasa &amp; Aksesoris"><span>Pemasukan Jasa &amp; Aksesoris</span><span id="recapJasa">Rp 0</span></div>
<div class="recap-item" data-target="#sewaTable3x10" data-tooltip="Detail dari tabel Sewa PS"><span>Pemasukan Sewa PS</span><span id="recapSewa">Rp 0</span></div>
<div class="recap-item total" data-tooltip="Jumlah semua pemasukan"><span><b>TOTAL KESELURUHAN</b></span><span id="grandTotal">Rp 0</span></div>
</div>
</div>
</div>
<div class="spacer"></div></div><!-- /card pad -->
<div class="spacer"></div>
<!-- Filter & Rentang (clean, square-rounded, responsive) -->
<div class="subcard filter-card">
<div class="pad">
<div class="filter-grid">
<div class="f-row">
<label for="monthFilter">Filter</label>
<select class="select" id="monthFilter"></select>
</div>
<div class="f-row" id="customMonthRow" style="display:none;">
<label for="customMonth">Pilih Bulan</label>
<div class="row" style="gap: var(--space-2);"><input class="input" id="customMonth" type="month"/>
<button class="btn" id="applyCustomMonth" type="button">Terapkan</button></div>
</div>
<div class="f-row">
<label for="dateFrom">Rentang</label>
<div class="range-wrap">
<input class="input" disabled="" id="dateFrom" type="date"/>
<span class="sep">s/d</span>
<input class="input" disabled="" id="dateTo" type="date"/>
<button class="btn" disabled="" id="rangeApply" type="button">Terapkan</button>
<button class="btn" disabled="" id="rangeClear" title="Kosongkan rentang" type="button">Bersihkan</button>
</div>
</div>
</div>
</div>
</div>
<div class="spacer"></div>
<div class="card pad">
<div style="overflow:auto;">
<div class="row" style="justify-content:space-between;align-items:center">
<div><b>History Pembukuan</b></div>
<div class="mini subtle">Riwayat semua pencatatan pemasukan</div>
</div>
<div style="overflow:auto;margin-top: var(--space-2)">
<table class="table-sm" id="table">
<thead>
<tr>
<th colspan="2" style="text-align:center;">Tanggal &amp; Hari</th>
<th rowspan="2">Harian</th>
<th rowspan="2">Jajanan</th>
<th rowspan="2">Jasa &amp; Aksesoris</th>
<th rowspan="2">Sewa PS</th>
<th rowspan="2">Total</th>
<th rowspan="2">Catatan</th>
<th rowspan="2">Aksi</th>
</tr>
<tr>
<th style="min-width:130px">Tanggal</th>
<th>Hari</th>
</tr>
</thead>
<tbody></tbody>
<tfoot>
<tr>
<td>Subtotal (tampil)</td><td></td>
<td class="mono right" id="sumHarian">Rp 0</td>
<td class="mono right" id="sumJajanan">Rp 0</td>
<td class="mono right" id="sumJasa">Rp 0</td>
<td class="mono right" id="sumSewa">Rp 0</td>
<td class="mono right" id="sumTotal">Rp 0</td>
<td colspan="2"></td>
</tr>
<tr class="total-row"><td colspan="6">Total bulan ini</td><td class="mono right" id="sumMonth">Rp 0</td><td colspan="2"></td></tr>
<tr class="total-row"><td colspan="6">Total semua</td><td class="mono right" id="sumAll">Rp 0</td><td colspan="2"></td></tr>
<tr class="total-row">
<td colspan="9" style="text-align:left; padding-top:8px;">
<button class="btn warn" id="clearBtn" title="Hapus semua data">Bersihkan Semua History</button>
</td>
</tr>
</tfoot>
</table>
</div>
<div class="note">Tombol <b>Edit</b> nge-load semua rincian ke form di atas biar bisa diperbaiki total.</div>
</div>
</div>
<div class="spacer"></div>
<div class="card pad" id="graphCard">
<div style="display:flex;justify-content:space-between;align-items:center;gap: var(--space-2);margin-bottom:8px">
<div><b>Grafik Total</b> <span class="mini subtle">titik berwarna sesuai ambang</span></div>
<button class="btn" id="saveGraphBtn" title="Simpan grafik sebagai gambar">Simpan Grafik</button>
</div>
<canvas height="260" id="dailyGraph" style="width:100%;display:block"></canvas>
<div id="graphLegend">
<div class="legend-item"><span class="legend-color" style="background:#e74c3c"></span> â‰¤ 100.000 (Merah)</div>
<div class="legend-item"><span class="legend-color" style="background:#f1c40f"></span> 100.001 â€“ 150.000 (Kuning)</div>
<div class="legend-item"><span class="legend-color" style="background:#2980b9"></span> 150.001 â€“ 200.000 (Biru)</div>
<div class="legend-item"><span class="legend-color" style="background:#2ecc71"></span> &gt; 200.000 (Hijau)</div>
</div>
<div class="mini subtle" id="graphCaption" style="margin-top:8px"></div>
</div><div style="color:var(--muted);font-size:12px;text-align:center;margin:16px 0 40px">
    Â© <span id="year"></span> URBAN GAMING LAMPUNG
  </div>
<div class="spacer"></div>
</div>
<input accept=".csv" id="fileInput" style="display:none" type="file"/>
<!-- === Themed Popups (Alert & Confirm) === -->
<div class="modal-backdrop" hidden="" id="popupBackdrop"></div>
<div class="modal" hidden="" id="themedConfirm">
<div>
<div class="modal-header">
<div class="modal-title">Konfirmasi</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body"></div>
<div class="modal-footer">
<button class="btn" data-cancel="">Batal</button>
<button class="btn primary" data-ok="">OK</button>
</div>
</div>
</div>
<div class="modal" hidden="" id="themedAlert">
<div>
<div class="modal-header">
<div class="modal-title">Info</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body"></div>
<div class="modal-footer">
<button class="btn primary" data-ok="">OK</button>
</div>
</div>
</div>
<!-- Themed Password Modal -->
<div class="modal" hidden="" id="themedPassword">
<div>
<div class="modal-header">
<div class="modal-title">Verifikasi</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body">
<label class="mini subtle" for="pwdInput">Masukkan password untuk melanjutkan</label>
<input autocomplete="current-password" class="input" id="pwdInput" placeholder="Password admin" type="password"/>
</div>
<div class="modal-footer">
<button class="btn" data-cancel="">Batal</button>
<button class="btn primary" data-ok="">OK</button>
</div>
</div>
</div>
<!-- === /Themed Popups === -->
<!-- Main Settings Modal -->
<div class="modal" hidden="" id="settingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Pengaturan</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="display: flex; flex-direction: column; gap: var(--space-2);">
<div class="settings-layout">
<!-- Sidebar kiri -->
<div class="settings-sidebar">
<button class="btn" data-settings-tab="theme"><span class="emoji">âš™ï¸</span> General</button>
<button class="btn" data-settings-tab="jajanan"><span class="emoji">ðŸ“</span>Edit Rincian</button>
<button class="btn" data-settings-tab="backup"><span class="emoji">ðŸ“¦</span>Backup &amp; Restore Data</button>
<button class="btn" data-settings-tab="export"><span class="emoji">ðŸ“¤</span>Export Data</button>
<button class="btn" id="resetSettingsBtn"><span class="emoji">â™»ï¸</span>Reset Setting</button><button class="btn" data-settings-tab="info"><span class="emoji">â„¹ï¸</span> Info</button>
</div>
<!-- Konten kanan -->
<div class="settings-content" id="settingsContentArea">
<!-- Tab: Theme -->
<div class="settings-tab" data-tab="theme">
<div class="setting-row"><span>Mode Tema</span><button class="btn setting-btn" id="themeToggleInSettings"><span class="emoji">ðŸŒ™</span>Gelap</button></div>
<div class="setting-row"><span>Kualitas Gambar</span><button class="btn setting-btn" id="qualityToggleInSettings"><span class="emoji">âœ¨</span>Tinggi</button></div>
</div>
<!-- Tab: Jajanan -->
<div class="settings-tab" data-tab="jajanan" hidden="">
<div style="display:flex;flex-direction:column;gap: var(--space-2);">
<button class="btn" id="openJenisPSHarianSettings">Item Jenis PS Pemasukan Harian</button>
<button class="btn" id="openJajananSettings">Item Jajanan</button>
<button class="btn" id="openJasaAksesorisSettings">Item Jasa &amp; Aksesori</button>
<button class="btn" id="openJenisPSSewaSettings">Item Jenis PS Pemasukan Sewa PS</button>
</div>
</div>
<!-- Tab: Backup & Restore -->
<div class="settings-tab" data-tab="backup" hidden="">
<div style="display:flex;flex-direction:column;gap: var(--space-2);">
<button class="btn" id="backupDataBtn"><span class="emoji">ðŸ’¾</span>Backup Data</button>
<button class="btn" id="restoreDataBtn"><span class="emoji">ðŸ“‚</span>Restore Data</button>
<input accept=".json" id="restoreFileInput" style="display:none;" type="file"/>
</div>
</div>
<!-- Tab: Export -->
<div class="settings-tab" data-tab="export" hidden="">
<div style="display:flex;flex-direction:column;gap: var(--space-2);">
<button class="btn" id="exportCSVBtn"><span class="emoji">ðŸ“„</span>Ekspor CSV</button>
</div>
</div>
<div class="settings-tab" data-tab="info" hidden="">
<div style="display:flex;flex-direction:column;gap:12px;font-size:14px;line-height:1.5;">
<!-- Apa ini -->
<div>
<h3 style="margin:0;font-size:16px;">ðŸ“Œ Tentang Aplikasi</h3>
<p>Aplikasi ini digunakan untuk mencatat transaksi, pemasukan, dan pengeluaran
        <b>URBAN PlayStation Lampung</b>. Aplikasi bersifat pribadi untuk kebutuhan internal.</p>
</div>
<!-- Bagaimana cara pakai -->
<div>
<h3 style="margin:0;font-size:16px;">ðŸ“ Panduan Singkat</h3>
<ul style="padding-left:18px; margin:6px 0;">
<li>Aplikasi ini sudah dilengkapi fitur <b>penjumlahan otomatis</b>, <b>grafik</b>, <b>tarik data</b>, <b>backup &amp; restore</b>, <b>filter tanggal</b>, serta pilihan <b>tema Gelap/Terang</b>.</li>
<li>Untuk <b>mengganti tema</b>, tekan tombol <b>Gelap/Terang</b> di pojok kanan atas.</li>
<li><b>Menambah atau mengedit item rincian</b> (PS, jajanan, jasa, sewa) bisa diakses melalui menu <b>Edit Rincian</b>.</li>
<li><b>Backup seluruh data</b> bisa dilakukan lewat menu <b>Backup &amp; Restore Data</b>.</li>
<li><b>Ekspor data ke CSV</b> dapat diakses pada menu <b>Export Data</b>.</li>
<li><b>Reset Setting</b> tersedia di menu <b>Reset Setting</b> untuk mengembalikan pengaturan default (data transaksi tetap aman).</li>
</ul>
<p style="margin-top:8px;color:var(--muted);font-size:13px;">
    ðŸ’¡ Tips: Jangan lupa lakukan backup data secara berkala agar catatan tidak hilang.
  </p>
</div>
<!-- Siapa pembuat & kontak -->
<div>
<h3 style="margin:0;font-size:16px;">ðŸ“ž Kontak</h3>
<p>URBAN PlayStation Lampung<br/>
      Telp/WA: <a href="tel:085709647790">085709647790</a></p>
</div>
<!-- Versi aplikasi -->
<div style="margin-top:8px;">
<p style="color:var(--muted);font-size:12px;">Build: <b>v2.0</b></p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-footer">
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<!-- Export Data Modal -->
<!-- Backup & Restore Data Modal -->
<div class="modal" hidden="" id="backupRestoreSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Backup &amp; Restore Data</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="display: flex; flex-direction: column; gap: var(--space-2);">
<button class="btn" id="backupDataBtn"><span class="emoji">ðŸ’¾</span>Backup Data</button>
<button class="btn" id="restoreDataBtn"><span class="emoji">ðŸ“‚</span>Restore Data</button>
<input accept=".json" id="restoreFileInput" style="display:none;" type="file"/>
</div>
<div class="modal-footer">
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<div class="modal" hidden="" id="exportDataSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Export Data</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="display: flex; flex-direction: column; gap: var(--space-2);">
<button class="btn" id="exportCSVBtn"><span class="emoji">ðŸ“„</span>Ekspor CSV</button>
</div>
<div class="modal-footer">
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<!-- Pengaturan Jajanan Modal -->
<div class="modal" hidden="" id="jajananSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Pengaturan Jajanan</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body">
<table id="jajananSettingsTable" style="width:100%;border-collapse:collapse;margin-bottom:12px">
<thead>
<tr><th style="text-align:left;padding: var(--space-1)">Nama Jajanan</th><th style="text-align:left;padding: var(--space-1)">Harga (Rp)</th><th style="padding: var(--space-1)">Aksi</th></tr>
</thead>
<tbody></tbody>
</table>
<button class="btn" id="addJajananItemBtn" type="button">+ Tambah Item</button>
</div>
<div class="modal-footer">
<button class="btn" data-cancel="">Batal</button>
<button class="btn primary" id="saveJajananSettingsBtn">Simpan</button>
</div>
</div>
</div>
<!-- Jenis PS Harian Modal -->
<div class="modal" hidden="" id="jenisPSHarianSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Item Jenis PS Pemasukan Harian</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="max-height:60vh;overflow:auto;">
<table id="jenisPSHarianTable" style="width:100%;border-collapse:collapse;margin-bottom:12px">
<thead><tr><th>Jenis PS</th><th>Harga (Rp)</th><th>Aksi</th></tr></thead>
<tbody></tbody>
</table>
<button class="btn" id="addJenisPSHarianBtn" type="button">+ Tambah Jenis PS</button>
</div>
<div class="modal-footer">
<button class="btn" id="saveJenisPSHarianBtn">Simpan</button>
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<!-- Jasa & Aksesoris Modal -->
<div class="modal" hidden="" id="jasaAksesorisSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Item Jasa &amp; Aksesoris</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="max-height:60vh;overflow:auto;">
<table id="jasaAksesorisTable" style="width:100%;border-collapse:collapse;margin-bottom:12px">
<thead><tr><th>Nama Jasa/Aksesoris</th><th>Harga (Rp)</th><th>Aksi</th></tr></thead>
<tbody></tbody>
</table>
<button class="btn" id="addJasaAksesorisBtn" type="button">+ Tambah Jasa/Aksesoris</button>
</div>
<div class="modal-footer">
<button class="btn" id="saveJasaAksesorisBtn">Simpan</button>
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<!-- Jenis PS Sewa Modal -->
<div class="modal" hidden="" id="jenisPSSewaSettingsModal">
<div>
<div class="modal-header">
<div class="modal-title">Item Jenis PS Pemasukan Sewa PS</div>
<button class="modal-close" data-close="">âœ•</button>
</div>
<div class="modal-body" style="max-height:60vh;overflow:auto;">
<table id="jenisPSSewaTable" style="width:100%;border-collapse:collapse;margin-bottom:12px">
<thead><tr><th>Jenis PS</th><th>Harga (Rp)</th><th>Aksi</th></tr></thead>
<tbody></tbody>
</table>
<button class="btn" id="addJenisPSSewaBtn" type="button">+ Tambah Jenis PS</button>
</div>
<div class="modal-footer">
<button class="btn" id="saveJenisPSSewaBtn">Simpan</button>
<button class="btn" data-close="">Tutup</button>
</div>
</div>
</div>
<script>
// === Themed Jendela Muncul Helpers ===
(function(){
  function $(sel){ return document.querySelector(sel); }
  function openModal(modalId, opts){
    return new Promise(function(resolve){
      var modal = document.getElementById(modalId);
      var backdrop = document.getElementById('popupBackdrop');
      var bodyEl = modal.querySelector('.modal-body');
      var titleEl = modal.querySelector('.modal-title');
      var okBtn = modal.querySelector('[data-ok]');
      var cancelBtn = modal.querySelector('[data-cancel]');
      var closeBtn = modal.querySelector('[data-close]');

      titleEl.textContent = (opts && opts.title) || titleEl.textContent || '';
      bodyEl.textContent = (opts && opts.message) || '';

      function show(){
        backdrop.hidden = false;
        modal.hidden = false;
        // small async to allow CSS transitions
        requestAnimationFrame(function(){
          backdrop.classList.add('is-visible');
          modal.classList.add('is-visible');
          (okBtn || closeBtn).focus();
        });
      }
      function hide(val){
        backdrop.classList.remove('is-visible');
        modal.classList.remove('is-visible');
        setTimeout(function(){
          backdrop.hidden = true;
          modal.hidden = true;
          cleanup();
          resolve(val);
        }, 200);
      }
      function onKey(e){
        if(e.key === 'Escape'){ hide(modalId === 'themedConfirm' ? false : true); }
      }
      function onBackdrop(e){
        if(e.target === backdrop){ hide(modalId === 'themedConfirm' ? false : true); }
      }
      function cleanup(){
        document.removeEventListener('keydown', onKey);
        backdrop.removeEventListener('click', onBackdrop);
        if(okBtn) okBtn.onclick = null;
        if(cancelBtn) cancelBtn.onclick = null;
        if(closeBtn) closeBtn.onclick = null;
      }

      if(okBtn){ okBtn.textContent = (opts && opts.okText) || 'OK'; okBtn.onclick = function(){ hide(true); }; }
      if(cancelBtn){ cancelBtn.textContent = (opts && opts.cancelText) || 'Batal'; cancelBtn.onclick = function(){ hide(false); }; }
      if(closeBtn){ closeBtn.onclick = function(){ hide(modalId === 'themedConfirm' ? false : true); }; }

      document.addEventListener('keydown', onKey);
      backdrop.addEventListener('click', onBackdrop);

      show();
    });
  }

  window.themedConfirm = function(message, options){
    return openModal('themedConfirm', { message: message, title:(options&&options.title)||'Konfirmasi', okText:(options&&options.okText), cancelText:(options&&options.cancelText) });
  };
  window.themedAlert = function(message, options){

// === Kustom Themed Peringatan with Kustom OK text & callback ===
window.themedAlertCustom = function(message, options){
  return new Promise(function(resolve){
    var modal = document.getElementById('themedAlert');
    var backdrop = document.getElementById('popupBackdrop');
    var bodyEl = modal.querySelector('.modal-body');
    var titleEl = modal.querySelector('.modal-title');
    var okBtn   = modal.querySelector('[data-ok]');

    titleEl.textContent = (options && options.title) || 'Info';
    bodyEl.textContent = message || '';
    okBtn.textContent = (options && options.okText) || 'OK';

    function hide(val){
      backdrop.classList.remove('is-visible');
      modal.classList.remove('is-visible');
      setTimeout(function(){
        backdrop.hidden = true; modal.hidden = true;
        resolve(val);
      },200);
    }

    okBtn.onclick = function(){ hide(true); if(options && typeof options.onOk === 'function'){ options.onOk(); } };

    backdrop.hidden = false; modal.hidden = false;
    requestAnimationFrame(function(){
      backdrop.classList.add('is-visible');
      modal.classList.add('is-visible');
      okBtn.focus();
    });
  });
};

    return openModal('themedAlert', { message: message, title:(options&&options.title)||'Info', okText:(options&&options.okText) });
  };
})();
// === /Themed Jendela Muncul Helpers ===

// === Jenis PS Harian Pengaturan ===
;(function(){
  var addBtn = document.getElementById('addJenisPSHarianBtn');
  if(addBtn){
    addBtn.addEventListener('click', function(){
      var tbody = document.querySelector('#jenisPSHarianTable tbody');
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td><input type="text" class="input" placeholder="Nama Jenis PS"></td>' +
        '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
        '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
      tbody.appendChild(tr);
    });
  }
  var table = document.querySelector('#jenisPSHarianTable');
  if(table){
    table.addEventListener('click', function(e){
      if(e.target.classList.contains('remove-item')){
        e.target.closest('tr').remove();
      }
    });
  }
})();

// === Jasa & Aksesoris Pengaturan ===
;(function(){
  var addBtn = document.getElementById('addJasaAksesorisBtn');
  if(addBtn){
    addBtn.addEventListener('click', function(){
      var tbody = document.querySelector('#jasaAksesorisTable tbody');
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td><input type="text" class="input" placeholder="Nama Jasa/Aksesoris"></td>' +
        '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
        '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
      tbody.appendChild(tr);
    });
  }
  var table = document.querySelector('#jasaAksesorisTable');
  if(table){
    table.addEventListener('click', function(e){
      if(e.target.classList.contains('remove-item')){
        e.target.closest('tr').remove();
      }
    });
  }
})();

// === Jenis PS Sewa Pengaturan ===
;(function(){
  var addBtn = document.getElementById('addJenisPSSewaBtn');
  if(addBtn){
    addBtn.addEventListener('click', function(){
      var tbody = document.querySelector('#jenisPSSewaTable tbody');
      var tr = document.createElement('tr');
      tr.innerHTML =
        '<td><input type="text" class="input" placeholder="Jenis PS"></td>' +
        '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
        '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
      tbody.appendChild(tr);
    });
  }
  var table = document.querySelector('#jenisPSSewaTable');
  if(table){
    table.addEventListener('click', function(e){
      if(e.target.classList.contains('remove-item')){
        e.target.closest('tr').remove();
      }
    });
  }
})();


// ===== Graphics Kualitas Tombol Pilih =====
const QUALITY_KEY = "urban_ps_quality";

function applyGraphicsQuality(q){
  document.body.setAttribute("data-quality", q === "rendah" ? "rendah" : "tinggi");
}

function getGraphicsQuality(){
  try { return localStorage.getItem(QUALITY_KEY) || "tinggi"; }
  catch(e){ return "tinggi"; }
}

function setGraphicsQuality(q){
  try { localStorage.setItem(QUALITY_KEY, q); }catch(e){}
  applyGraphicsQuality(q);
}

document.addEventListener("DOMContentLoaded", function(){
  var select = document.getElementById("graphicsQualitySelect");
  if(select){
    var cur = getGraphicsQuality();
    select.value = cur;
    applyGraphicsQuality(cur);
    select.addEventListener("change", function(){
      setGraphicsQuality(this.value);
    });
  }
});



// ===== Graphics Kualitas Tombol Pilih (Tombol Style) =====
const QUALITY_KEY_BTN = "urban_ps_quality";

function applyGraphicsQualityBtn(q){
  document.body.setAttribute("data-quality", q === "rendah" ? "rendah" : "tinggi");
  var btn = document.getElementById("qualityToggleInSettings");
  if(btn){
    if(q === "rendah"){
      btn.innerHTML = '<span class="emoji">ðŸ“‰</span> Rendah';
    } else {
      btn.innerHTML = '<span class="emoji">âœ¨</span> Tinggi';
    }
  }
}

function getGraphicsQualityBtn(){
  try { return localStorage.getItem(QUALITY_KEY_BTN) || "tinggi"; }
  catch(e){ return "tinggi"; }
}

function setGraphicsQualityBtn(q){
  try { localStorage.setItem(QUALITY_KEY_BTN, q); }catch(e){}
  applyGraphicsQualityBtn(q);
}

document.addEventListener("DOMContentLoaded", function(){
  var btn = document.getElementById("qualityToggleInSettings");
  if(btn){
    var cur = getGraphicsQualityBtn();
    applyGraphicsQualityBtn(cur);
    btn.addEventListener("click", function(){
      var next = (getGraphicsQualityBtn() === "tinggi") ? "rendah" : "tinggi";
      setGraphicsQualityBtn(next);
    });
  }
});

</script>
<script>
  // === Themed Kata Sandi Prompt (matches existing Jendela Dialog/backdrop) ===
  window.themedPromptPassword = function(options){
    return new Promise(function(resolve){
      var modal = document.getElementById('themedPassword');
      var backdrop = document.getElementById('popupBackdrop');
      if(!modal || !backdrop){ return resolve(null); }

      var titleEl = modal.querySelector('.modal-title');
      var input   = modal.querySelector('#pwdInput');
      var okBtn   = modal.querySelector('[data-ok]');
      var cancel  = modal.querySelector('[data-cancel]');
      var close   = modal.querySelector('[data-close]');

      titleEl.textContent = (options && options.title) || 'Verifikasi';
      if(input){
        input.placeholder = (options && options.placeholder) || 'Password admin';
        input.value = '';
      }

      function show(){
        backdrop.hidden = false; modal.hidden = false;
        requestAnimationFrame(function(){
          backdrop.classList.add('is-visible');
          modal.classList.add('is-visible');
          setTimeout(function(){ try{ input && input.focus(); }catch(_){} }, 30);
        });
      }
      function hide(val){
        backdrop.classList.remove('is-visible');
        modal.classList.remove('is-visible');
        setTimeout(function(){
          backdrop.hidden = true; modal.hidden = true;
          cleanup(); resolve(val);
        }, 200);
      }
      function onKey(e){
        if(e.key === 'Escape') hide(null);
        if(e.key === 'Enter')  hide(String((input && input.value) || ''));
      }
      function onBackdrop(e){ if(e.target === backdrop) hide(null); }
      function cleanup(){
        document.removeEventListener('keydown', onKey);
        backdrop.removeEventListener('click', onBackdrop);
        if(okBtn) okBtn.onclick = null;
        if(cancel) cancel.onclick = null;
        if(close) close.onclick = null;
      }

      if(okBtn)   okBtn.onclick   = function(){ hide(String((input && input.value) || '')); };
      if(cancel)  cancel.onclick  = function(){ hide(null); };
      if(close)   close.onclick   = function(){ hide(null); };
      document.addEventListener('keydown', onKey);
      backdrop.addEventListener('click', onBackdrop);
      show();
    });
  };
</script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
(function(){
  function onReady(fn){
    if(document.readyState==='complete' || document.readyState==='interactive'){ setTimeout(fn,0); }
    else document.addEventListener('DOMContentLoaded', fn);
  }

  onReady(function(){

// ===== Pengaturan Jajanan (Integrated inside onReady) =====
(function(){
  var JAJ_PRICE_DEFAULT = {
    "Kopi Panas Original":3000,"Teh Panas":3000,"Es Teh":3000,"Kopi Kapal Api":3000,
    "GoodDay Capuchino Panas":4000,"GoodDay Capuchino Dingin":5000,
    "Luwak White Cofee Panas":4000,"Luwak White Cofee Dingin":5000,
    "Torabika Moka Panas":4000,"Torabika Moka Dingin":5000,
    "Marimas":2000,"Nutrisari":3000,
    "Mie Pakai Telor (Free Nasi)":10000,"Mie Tanpa Telor (Free Nasi)":7000,"Pop Mie (Free Nasi)":8000
  };
  function loadJajananSettings(){
    try {
      var saved = JSON.parse(localStorage.getItem('urban_ps_jajanan_settings')||'{}');
      return Object.assign({}, JAJ_PRICE_DEFAULT, saved);
    } catch(e){
      return Object.assign({}, JAJ_PRICE_DEFAULT);
    }
  }
  function saveJajananSettings(newData){
    localStorage.setItem('urban_ps_jajanan_settings', JSON.stringify(newData));
  }
  function showJajananSettingsModal(){
    var modal = document.getElementById('jajananSettingsModal');
    var backdrop = document.getElementById('popupBackdrop');
    var tbody = document.querySelector('#jajananSettingsTable tbody');
    tbody.innerHTML = '';
    var data = loadJajananSettings();
    Object.keys(data).forEach(function(name){
      var tr = document.createElement('tr');
      tr.innerHTML = '<td style="padding:4px"><input type="text" class="input" value="'+name+'"></td>'+
                     '<td style="padding:4px"><input type="number" class="input mono" value="'+data[name]+'"></td>'+
                     '<td style="padding:4px;text-align:center"><button class="btn warn remove-item" type="button">Hapus</button></td>';
      tbody.appendChild(tr);
    });
    backdrop.hidden = false;
    modal.hidden = false;
    requestAnimationFrame(function(){
      backdrop.classList.add('is-visible');
      modal.classList.add('is-visible');
    });
    function onBackdropClick(e){ if(e.target === backdrop) hideModal(); }
    backdrop.addEventListener('click', onBackdropClick, { once: true });
  }
  function hideModal(){
    var modal = document.getElementById('jajananSettingsModal');
    var backdrop = document.getElementById('popupBackdrop');
    backdrop.classList.remove('is-visible');
    modal.classList.remove('is-visible');
    setTimeout(function(){
      backdrop.hidden = true;
      modal.hidden = true;
    },200);
  }
  var __jajBtn = document.getElementById('jajananSettingsBtn');
  if(__jajBtn){ __jajBtn.addEventListener('click', showJajananSettingsModal); }
  window.showJajananSettingsModal = showJajananSettingsModal;
  document.querySelector('#jajananSettingsModal [data-close]').addEventListener('click', hideModal);
  document.querySelector('#jajananSettingsModal [data-cancel]').addEventListener('click', hideModal);
  document.getElementById('addJajananItemBtn').addEventListener('click', function(){
    var tbody = document.querySelector('#jajananSettingsTable tbody');
    var tr = document.createElement('tr');
    tr.innerHTML = '<td style="padding:4px"><input type="text" class="input" placeholder="Nama Jajanan"></td>'+
                   '<td style="padding:4px"><input type="number" class="input mono" placeholder="Harga"></td>'+
                   '<td style="padding:4px;text-align:center"><button class="btn warn remove-item" type="button">Hapus</button></td>';
    tbody.appendChild(tr);
  });
  document.querySelector('#jajananSettingsTable').addEventListener('click', function(e){
    if(e.target.classList.contains('remove-item')){
      e.target.closest('tr').remove();
    }
  });
  document.getElementById('saveJajananSettingsBtn').addEventListener('click', function(){
    var tbody = document.querySelector('#jajananSettingsTable tbody');
    var newData = {};
    tbody.querySelectorAll('tr').forEach(function(tr){
      var name = tr.querySelector('td:nth-child(1) input').value.trim();
      var price = parseInt(tr.querySelector('td:nth-child(2) input').value)||0;
      if(name) newData[name] = price;
    });
    saveJajananSettings(newData);
    hideModal();
    buildJajanan3x10();
  });
  // Override buildJajanan3x10 to use saved Pengaturan
  var originalBuildJajanan3x10 = buildJajanan3x10;
  buildJajanan3x10 = function(){
    JAJ_PRICE = loadJajananSettings();
    var tb = document.querySelector('#jajananTable3x10 tbody'); tb.innerHTML='';
    var items = Object.keys(JAJ_PRICE);
    for(var i=0;i<5;i++){
      var tr=document.createElement('tr');
      tr.innerHTML = '<td>'+(i+1)+'</td>' +
        '<td><select class="select mini j3-jenis"><option value="">-</option>'+items.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
        '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
            '<input type="number" min="0" step="1" placeholder="0" class="input mono mini j3-qty"/>' +
            '<input type="time" class="input mini j3-jam"/></div></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" readonly class="input mono mini j3-harga"/></td>';
      tb.appendChild(tr);
    }
    document.querySelectorAll('#jajananTable3x10 tbody tr').forEach(function(tr){
      var sel=tr.querySelector('.j3-jenis'), qty=tr.querySelector('.j3-qty'), harga=tr.querySelector('.j3-harga');
      function recalc(){ var unit=JAJ_PRICE[sel.value]||0; var q=parseInt(qty.value)||0; harga.value=unit*q; sumJajanan3x10(); }
      sel.addEventListener('change', recalc); qty.addEventListener('input', recalc);
    });
  };
})();
    // ===== Helpers
    function $(sel){ return document.querySelector(sel); }
    function $all(sel){ return Array.prototype.slice.call(document.querySelectorAll(sel)); }
    function ID(){ return Math.random().toString(36).slice(2,9); }
    function cleanNum(v){ var n=parseInt(v,10); if(isNaN(n)||!isFinite(n)||n<0) n=0; return n; }
    function monthKey(d){ return (d||'').slice(0,7); }
    function todayStr(){ var o=(new Date()).getTimezoneOffset(); var d=new Date(Date.now()-o*60000); return d.toISOString().slice(0,10); }
    function fmtIDR(n){ try { return (n||0).toLocaleString('id-ID',{style:'currency',currency:'IDR',maximumFractionDigits:0}); } catch(e){ return 'Rp '+String(n||0).replace(/\\B(?=(\\d{3})+(?!\\d))/g,'.'); } }


    function setRangeControlsEnabled(isRange){
      var ids = ['dateFrom','dateTo','rangeApply','rangeClear'];
      ids.forEach(function(id){
        var el = document.getElementById(id);
        if(!el) return;
        el.disabled = !isRange;
        el.style.opacity = isRange ? '1' : '0.5';
      });
      if(!isRange){
        var from = document.getElementById('dateFrom');
        var to   = document.getElementById('dateTo');
        if(from) from.value = '';
        if(to)   to.value = '';
        if(window.state) window.state.range = null;
      }
    }
    // ===== Tema Tombol Pilih (persist)
    var THEME_KEY = 'urban_ps_theme';
    function applyTheme(t){
      document.documentElement.setAttribute('data-theme', t==='light' ? 'light' : null);
      var btn = $('#themeBtn');
      if(btn){ btn.textContent = (t==='light') ? 'â˜€ï¸ Terang' : 'ðŸŒ™ Gelap'; }
    }
    function getTheme(){ try{ return localStorage.getItem(THEME_KEY)||'dark'; }catch(e){ return 'dark'; } }
    function setTheme(t){ try{ localStorage.setItem(THEME_KEY,t); }catch(e){} applyTheme(t); }
    $('#themeBtn').addEventListener('click', function(){
      var cur = getTheme();
      setTheme(cur==='light' ? 'dark' : 'light');
    });
    applyTheme(getTheme());

    // ===== State & Persistence
    var state = { entries:[], filter:'WEEK', range:null, editingId:null };
    function save(){ try{ localStorage.setItem('urban_ps_pembukuan', JSON.stringify(state.entries)); }catch(e){} }
    function load(){ try{ state.entries = JSON.parse(localStorage.getItem('urban_ps_pembukuan')||'[]'); }catch(e){ state.entries=[]; } }

    // ===== Build Bulan Filter
    function prettyMonth(ym){ var p=ym.split('-'); var d=new Date(+p[0],+p[1]-1,1); try{ return d.toLocaleDateString('id-ID',{month:'long',year:'numeric'}); }catch(e){ return ym; } }
    function buildMonthFilter(){
      var sel=$('#monthFilter'); var map={}, months=[];
      for(var i=0;i<state.entries.length;i++){ 
        var mk=monthKey(state.entries[i].date); 
        if(mk && !map[mk]){ map[mk]=1; months.push(mk); } 
      }
      months.sort(); sel.innerHTML='';
      var optAll=document.createElement('option'); 
      optAll.value='ALL'; 
      optAll.textContent='Semua Bulan'; 
      sel.appendChild(optAll);

// Tambahkan opsi Pilih Bulan setelah Semua Bulan
var optCustom=document.createElement('option');
optCustom.value='CUSTOM_MONTH';
optCustom.textContent='Pilih Bulan';
sel.appendChild(optCustom);

      // Tambahkan opsi Satu Minggu setelah Semua Bulan
      var optWeek=document.createElement('option'); 
      optWeek.value='WEEK'; 
      optWeek.textContent='Satu Minggu (Senin - Minggu)'; 
      sel.insertBefore(optWeek, sel.children[1]);


      // bulan otomatis dihilangkan

      // Append Rentang option at the bottom
      var optRange=document.createElement('option'); 
      optRange.value='RENTANG'; 
      optRange.textContent='Rentang'; 
      sel.appendChild(optRange);

      sel.value = (state.filter === 'CUSTOM_MONTH') ? 'CUSTOM_MONTH' : state.filter;
      // Append Rentang option
    }

    function filtered(){
      var list;
      if (state.filter === 'ALL') {
        list = state.entries.slice();
      } else if (state.filter === 'RENTANG') {
        // If no range selected, return empty list immediately
        if (!state.range || (!state.range.from && !state.range.to)) {
          return [];
        }
        list = state.entries.slice();

      } else if (state.filter === 'WEEK') {
        var today = new Date();
        var day = today.getDay(); // 0=Sunday, 1=Monday
        var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
        var monday = new Date(today);
        monday.setDate(today.getDate() + diff);
        var sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        list = state.entries.filter(function(e){ return e.date >= from && e.date <= to; });

      } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
        list = state.entries.filter(function(e){ return monthKey(e.date) === state.filter; });
      }

      if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);
    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var weekList = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    monthSum = calcSums(weekList).total;
} else if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // geser ke Senin
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);

    var list = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    var map = {};
    list.forEach(function(e){
        var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
        map[e.date] = (map[e.date]||0) + tot;
    });

    for (var dt = new Date(monday); dt <= sunday; dt.setDate(dt.getDate() + 1)) {
        var iso = new Date(dt.getTime() - dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
        data.push({date: iso, value: map[iso]||0});
    }

    if(caption) caption.textContent = 'Minggu ini: ' + from + ' s/d ' + to + ' â€¢ ' + data.length + ' hari';
} else if (state.filter === 'RENTANG' && state.range && (state.range.from || state.range.to)) {
        var from = state.range.from || '0000-01-01';
        var to   = state.range.to   || '9999-12-31';
        list = list.filter(function(e){
          var d = e.date || '';
          return d && d >= from && d <= to;
        });
      }

      return list;
    }
    function calcSums(list){
      var s={harian:0,jajanan:0,jasa:0,sewa:0,total:0};
      list.forEach(function(e){ s.harian+=cleanNum(e.harian); s.jajanan+=cleanNum(e.jajanan); s.jasa+=cleanNum(e.jasa); s.sewa+=cleanNum(e.sewa); });
      s.total=s.harian+s.jajanan+s.jasa+s.sewa; return s;
    }

    // ===== Grand Total live
    window.sumGrandLive = function(){
      var g = cleanNum($('#harian').value)+cleanNum($('#jajanan').value)+cleanNum($('#jasa').value)+cleanNum($('#sewa').value);
      $('#grandTotal').textContent = fmtIDR(g); updateRecap();
// Handler tombol Terapkan Kustom Bulan
(function(){
  var btn = document.getElementById('applyCustomMonth');
  if(btn){
    btn.addEventListener('click', function(){
      var val = document.getElementById('customMonth').value;
      if(val){
        state.filter = 'CUSTOM_MONTH';       // tetap di mode Kustom
        state.customMonthValue = val;        // simpan bulan yg dipilih, contoh "2025-08"
        render();
      }
    });
  }
})();

    };


    function getDayName(dateStr){
      if(!dateStr) return "-";
      try {
        var opts = { weekday: 'long' };
        return new Date(dateStr).toLocaleDateString('id-ID', opts);
      } catch(e){ return "-"; }
    }

    function updateRecap(){
      var fmt = fmtIDR;
      var h = cleanNum($('#harian').value);
      var j = cleanNum($('#jajanan').value);
      var ja = cleanNum($('#jasa').value);
      var s = cleanNum($('#sewa').value);
      var _h=$('#recapHarian'), _j=$('#recapJajanan'), _ja=$('#recapJasa'), _s=$('#recapSewa');
      if(_h) _h.textContent = fmt(h);
      if(_j) _j.textContent = fmt(j);
      if(_ja) _ja.textContent = fmt(ja);
      if(_s) _s.textContent = fmt(s);
    }

function scrollToTopMobile() {
  try {
    if (document.activeElement && typeof document.activeElement.blur === 'function') {
      document.activeElement.blur();
    }
  } catch(e) {}
  var header = document.querySelector('.header');
  if (header && header.scrollIntoView) {
    try { header.scrollIntoView({ behavior: 'smooth', block: 'start' }); } catch(e) {}
  }
  var root = document.scrollingElement || document.documentElement || document.body;
  if (root && root.scrollTo) {
    try { root.scrollTo(0, 0); } catch(e) {}
    requestAnimationFrame(function(){
      setTimeout(function(){
        try { root.scrollTo({ top: 0, behavior: 'smooth' }); } catch(e) { try { root.scrollTop = 0; } catch(_) {} }
      }, 80);
    });
  } else {
    try { document.documentElement.scrollTop = 0; document.body.scrollTop = 0; } catch(e) {}
  }
}


    // ====== Tables builders & Jumlah
    // RINCIAN HARIAN
    var rincianBody = $('#rincianTable tbody');
    var RENTAL_RATE = { PS3:{hour:5000,half:3000}, PS4:{hour:7000,half:4000} };
    function hitungHarga(ps,jumlah){
      if(!ps) return 0; var r=RENTAL_RATE[ps]; if(!r) return 0;
      var n=parseFloat(jumlah); if(isNaN(n)||!isFinite(n)||n<=0) return 0;
      var whole=Math.floor(n); var rem=Math.round((n-whole)*10)/10; var total=whole*r.hour;
      if(Math.abs(rem-0.5)<0.001) total+=r.half; else if(rem>0) total+=Math.round(rem*r.hour);
      return total;
    }
    function buildRincianRows(){
      rincianBody.innerHTML='';
      for(var i=1;i<=10;i++){
        var tr=document.createElement('tr');
        tr.innerHTML = '<td>'+i+'</td>' +
          '<td><select class="select mini r-jenis"><option value="">-</option><option>PS3</option><option>PS4</option></select></td>' +
          '<td><input type="time" class="input mini r-jam"/></td>' +
          '<td><input type="number" min="0" step="0.5" placeholder="0" class="input mono mini r-jumlah"/></td>' +
          '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini rincian-harga r-harga"/></td>';
        rincianBody.appendChild(tr);
      }
      wireRincianEvents();
    }
    function sumRincian(){
      var sum=0; $all('.rincian-harga').forEach(function(inp){ sum+=cleanNum(inp.value); });
      $('#rincianTotal').textContent=fmtIDR(sum); $('#harian').value=sum; if(window.sumGrandLive) window.sumGrandLive(); updateRecap(); updateRecap();
    }
    function wireRincianEvents(){
      $all('#rincianTable tbody tr').forEach(function(tr){
        var sel = tr.querySelector('.r-jenis'); var j = tr.querySelector('.r-jumlah'); var h = tr.querySelector('.r-harga');
        function recalc(){ var harga=hitungHarga(sel.value,j.value); h.value=harga?String(harga):''; sumRincian(); }
        sel.addEventListener('change', recalc); j.addEventListener('input', recalc);
      });
      $all('.r-harga').forEach(function(inp){ inp.addEventListener('input', sumRincian); });
    }
    $('#rincianClear').addEventListener('click', function(){ $all('#rincianTable input, #rincianTable select').forEach(function(i){ i.value=''; }); sumRincian(); });

    // JAJANAN 3x10 (5 rows)
    var JAJ_PRICE = {
      "Kopi Panas Original":3000,"Teh Panas":3000,"Es Teh":3000,"Kopi Kapal Api":3000,
      "GoodDay Capuchino Panas":4000,"GoodDay Capuchino Dingin":5000,
      "Luwak White Cofee Panas":4000,"Luwak White Cofee Dingin":5000,
      "Torabika Moka Panas":4000,"Torabika Moka Dingin":5000,
      "Marimas":2000,"Nutrisari":3000,
      "Mie Pakai Telor (Free Nasi)":10000,"Mie Tanpa Telor (Free Nasi)":7000,"Pop Mie (Free Nasi)":8000
    };
    function buildJajanan3x10(){
      var tb = $('#jajananTable3x10 tbody'); tb.innerHTML='';
      var items=Object.keys(JAJ_PRICE);
      for(var i=0;i<5;i++){
        var tr=document.createElement('tr');
        tr.innerHTML = '<td>'+(i+1)+'</td>' +
          '<td><select class="select mini j3-jenis"><option value="">-</option>'+items.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
          '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
              '<input type="number" min="0" step="1" placeholder="0" class="input mono mini j3-qty"/>' +
              '<input type="time" class="input mini j3-jam"/></div></td>' +
          '<td><input type="number" min="0" step="100" placeholder="0" readonly class="input mono mini j3-harga"/></td>';
        tb.appendChild(tr);
      }
      $all('#jajananTable3x10 tbody tr').forEach(function(tr){
        var sel=tr.querySelector('.j3-jenis'), qty=tr.querySelector('.j3-qty'), harga=tr.querySelector('.j3-harga');
        function recalc(){ var unit=JAJ_PRICE[sel.value]||0; var q=cleanNum(qty.value); harga.value=unit*q; sumJajanan3x10(); }
        sel.addEventListener('change', recalc); qty.addEventListener('input', recalc);
      });
    }
    function sumJajanan3x10(){
      var tot=0; $all('.j3-harga').forEach(function(i){ tot+=cleanNum(i.value); });
      $('#jajananTotal3x10').textContent=fmtIDR(tot); $('#jajanan').value=tot; if(window.sumGrandLive) window.sumGrandLive(); updateRecap(); updateRecap();
    }
    document.addEventListener('click', function(e){ if(e.target && e.target.id==='jajanan3x10Clear'){ $all('#jajananTable3x10 input, #jajananTable3x10 select').forEach(function(i){ i.value=''; }); sumJajanan3x10(); } });

    // JASA 2x5
    var JASA_TYPES=["Isi Game","Stik & Aksesoris","Upgrade HEN","Aksesoris"];
    function buildJasa2x5(){
      var tb=$('#jasaTable2x5 tbody'); tb.innerHTML='';
      for(var i=0;i<5;i++){
        var tr=document.createElement('tr');
        tr.innerHTML = '<td>'+ (i+1) +'</td>' +
          '<td><select class="select mini jasa-type"><option value="">-</option>'+JASA_TYPES.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
          '<td><input type="text" class="input mini jasa-note" placeholder="keterangan (opsional)"/></td>' +
          '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini jasa-price"/></td>';
        tb.appendChild(tr);
      }
      $all('.jasa-price').forEach(function(inp){ inp.addEventListener('input', sumJasa2x5); });
    }
    function sumJasa2x5(){
      var tot=0; $all('.jasa-price').forEach(function(i){ tot+=cleanNum(i.value); });
      $('#jasaTotal2x5').textContent=fmtIDR(tot); $('#jasa').value=tot; if(window.sumGrandLive) window.sumGrandLive(); updateRecap(); updateRecap();
    }
    document.addEventListener('click', function(e){ if(e.target && e.target.id==='jasa2x5Clear'){ $all('#jasaTable2x5 input, #jasaTable2x5 select').forEach(function(i){ i.value=''; }); sumJasa2x5(); } });

    // SEWA 3x10 (5 rows)
    var SEWA_TYPES=["PS3","PS4","PS3 + TV","PS4 + TV","PS3 Portable","PS4 Portable","Hanya TV"];
    var SEWA_RATES={ "PS3":{h12:40000,h24:70000},"PS4":{h12:80000,h24:140000},"PS3 + TV":{h12:60000,h24:100000},"PS4 + TV":{h12:100000,h24:170000},"PS3 Portable":{h12:60000,h24:100000},"PS4 Portable":{h12:100000,h24:170000},"Hanya TV":{h12:30000,h24:50000} };
    function hoursFromDurasiSelect(selVal, manualVal){
      var mv=parseFloat(manualVal); if(!isNaN(mv) && isFinite(mv) && mv>0) return mv;
      switch(selVal){ case '12JAM':return 12; case '1HARI':return 24; case '2HARI':return 48; case '3HARI':return 72; default:return 0; }
    }
    function calcSewaPrice(type,hours){
      var r=SEWA_RATES[type]; if(!r||!hours||hours<=0) return 0;
      if(hours<=12) return r.h12; if(hours<=24) return r.h24; var days=Math.ceil(hours/24); return days*r.h24;
    }
    function buildSewa3x10(){
      var tb=$('#sewaTable3x10 tbody'); tb.innerHTML='';
      for(var i=0;i<5;i++){
        var tr=document.createElement('tr');
        tr.innerHTML = '<td>'+(i+1)+'</td>' +
          '<td><select class="select mini sewa-jenis"><option value="">-</option>'+SEWA_TYPES.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
          '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
              '<select class="select mini sewa-durasi"><option value="">-</option><option value="12JAM">12 JAM</option><option value="1HARI">1 HARI</option><option value="2HARI">2 HARI</option><option value="3HARI">3 HARI</option></select>' +
              '<input type="text" placeholder="Isi Sendiri" class="input mini sewa-manual"/></div></td>' +
          '<td><input type="text" placeholder="note (optional)" class="input mini sewa-lama-note"/></td><td><input type="number" min="0" step="1000" placeholder="0" class="input mono mini sewa-harga"/></td>';
        tb.appendChild(tr);
      }
      $all('#sewaTable3x10 tbody tr').forEach(function(tr){
        var selJ=tr.querySelector('.sewa-jenis'); var selD=tr.querySelector('.sewa-durasi'); var inM=tr.querySelector('.sewa-manual'); var inH=tr.querySelector('.sewa-harga');
        function recalc(){
  var manualVal = (inM.value || '').trim();
  if(manualVal){
    // User filled 'Isi Sendiri', skip auto calculation entirely
    return;
  }
  var jam = hoursFromDurasiSelect(selD.value, '');
  var price = calcSewaPrice(selJ.value, jam);
  if(price>0){ inH.value = price; }
  else { inH.value=''; }
  sumSewa3x10();
}
        selJ.addEventListener('change', recalc); selD.addEventListener('change', recalc); inM.addEventListener('input', recalc); inH.addEventListener('input', sumSewa3x10);
      });
    }
    function sumSewa3x10(){
      var tot=0; $all('.sewa-harga').forEach(function(i){ tot+=cleanNum(i.value); });
      $('#sewaTotal3x10').textContent=fmtIDR(tot); $('#sewa').value=tot; if(window.sumGrandLive) window.sumGrandLive(); updateRecap(); updateRecap();
    }
    document.addEventListener('click', function(e){ if(e.target && e.target.id==='sewa3x10Clear'){ $all('#sewaTable3x10 input, #sewaTable3x10 select').forEach(function(i){ i.value=''; }); sumSewa3x10(); } });

    // ===== Serialize details
    function collectDetails(){
      var rincian = $all('#rincianTable tbody tr').map(function(tr){
        return {
          jenis: tr.querySelector('.r-jenis').value || '',
          jam: tr.querySelector('.r-jam').value || '',
          jumlah: tr.querySelector('.r-jumlah').value || '',
          harga: cleanNum(tr.querySelector('.r-harga').value)
        };
      });
      var jajanan = $all('#jajananTable3x10 tbody tr').map(function(tr){
        return {
          jenis: tr.querySelector('.j3-jenis').value || '',
          qty: cleanNum(tr.querySelector('.j3-qty').value),
          jam: tr.querySelector('.j3-jam').value || '',
          harga: cleanNum(tr.querySelector('.j3-harga').value)
        };
      });
      var jasa = $all('#jasaTable2x5 tbody tr').map(function(tr){
        return {
          tipe: tr.querySelector('.jasa-type').value || '',
          ket: (tr.querySelector('.jasa-note') && tr.querySelector('.jasa-note').value) || '',
          harga: cleanNum(tr.querySelector('.jasa-price').value)
        };
      });
      var sewa = $all('#sewaTable3x10 tbody tr').map(function(tr){
  return {
    jenis: tr.querySelector('.sewa-jenis').value || '',
    durasi: tr.querySelector('.sewa-durasi').value || '',
    manualJam: tr.querySelector('.sewa-manual').value || '',
    lamaNote: (tr.querySelector('.sewa-lama-note') && tr.querySelector('.sewa-lama-note').value) || '',
    harga: cleanNum(tr.querySelector('.sewa-harga').value)
  };
});
      return { rincian:rincian, jajanan3x10:jajanan, jasa2x5:jasa, sewa3x10:sewa };
    }


    // ===== Validation helpers
    function detailsIsEmpty(det){
      det = det || collectDetails();
      function anyIn(arr, keys){
        if(!arr) return false;
        for(var i=0;i<arr.length;i++){
          var o = arr[i] || {};
          for(var k=0;k<keys.length;k++){
            var v = o[keys[k]];
            if(typeof v === 'number' && v > 0) return true;
            if(typeof v === 'string' && String(v).trim() !== '') return true;
          }
        }
        return false;
      }
      // If any detail field has content/value, not empty
      if(anyIn(det.rincian, ['jenis','jam','jumlah','harga'])) return false;
      if(anyIn(det.jajanan3x10, ['jenis','qty','jam','harga'])) return false;
      if(anyIn(det.jasa2x5, ['tipe','ket','harga'])) return false;
      if(anyIn(det.sewa3x10, ['jenis','durasi','manualJam','lamaNote','harga'])) return false;
      return true;
    }
    function formIsTrulyEmpty(){
      var h = cleanNum($('#harian').value);
      var j = cleanNum($('#jajanan').value);
      var ja = cleanNum($('#jasa').value);
      var s = cleanNum($('#sewa').value);
      var cat = ($('#catatan').value||'').trim();
      // Consider "empty" if all numeric incomes are zero AND no detail inputs filled.
      // Catatan alone does not count as data.
      var det = collectDetails();
      return (h + j + ja + s === 0) && detailsIsEmpty(det);
    }

    // ===== Apply details
    function applyDetails(det){
      det = det || {};
      $all('#rincianTable tbody tr').forEach(function(tr,idx){
        var d = (det.rincian && det.rincian[idx]) || {};
        tr.querySelector('.r-jenis').value = d.jenis || '';
        tr.querySelector('.r-jam').value = d.jam || '';
        tr.querySelector('.r-jumlah').value = d.jumlah || '';
        tr.querySelector('.r-harga').value = d.harga || '';
      });
      sumRincian();
      $all('#jajananTable3x10 tbody tr').forEach(function(tr,idx){
        var d = (det.jajanan3x10 && det.jajanan3x10[idx]) || {};
        tr.querySelector('.j3-jenis').value = d.jenis || '';
        tr.querySelector('.j3-qty').value = d.qty || '';
        tr.querySelector('.j3-jam').value = d.jam || '';
        tr.querySelector('.j3-harga').value = d.harga || '';
      });
      sumJajanan3x10();
      $all('#jasaTable2x5 tbody tr').forEach(function(tr,idx){
        var d = (det.jasa2x5 && det.jasa2x5[idx]) || {};
        tr.querySelector('.jasa-type').value = d.tipe || '';
        var note = tr.querySelector('.jasa-note'); if(note) note.value = d.ket || '';
        tr.querySelector('.jasa-price').value = d.harga || '';
      });
      sumJasa2x5();
      $all('#sewaTable3x10 tbody tr').forEach(function(tr,idx){
  var d = (det.sewa3x10 && det.sewa3x10[idx]) || {};
  tr.querySelector('.sewa-jenis').value = d.jenis || '';
  tr.querySelector('.sewa-durasi').value = d.durasi || '';
  tr.querySelector('.sewa-manual').value = d.manualJam || '';
  var note = d.lamaNote || '';
  var noteEl = tr.querySelector('.sewa-lama-note'); if(noteEl) noteEl.value = note;
  tr.querySelector('.sewa-harga').value = d.harga || '';
});
sumSewa3x10();
      if(window.sumGrandLive) window.sumGrandLive(); updateRecap();
      try{ drawDailyGraph(); }catch(e){ /* ignore */ }
    }

    // ===== Inline editable cells
    function editableMoneyCell(value, onCommit){
      var span=document.createElement('span');
      span.textContent=fmtIDR(cleanNum(value));
      span.style.cursor='pointer'; span.title='Klik untuk ubah';
      span.addEventListener('click', function(){
        var input=document.createElement('input');
        input.type='number'; input.className='input mono'; input.style.padding='6px 8px'; input.value=cleanNum(value);
        span.parentNode.replaceChild(input, span);
        input.focus();
        var commit=function(){ onCommit(cleanNum(input.value)); };
        input.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); commit(); }});
        input.addEventListener('blur', commit);
      });
      return span;
    }
    function editableTextCell(value, onCommit){
      var span=document.createElement('span'); span.textContent=value||''; span.style.cursor='pointer'; span.title='Klik untuk ubah';
      span.addEventListener('click', function(){
        var input=document.createElement('textarea'); input.className='input'; input.rows=2; input.value=value||'';
        span.parentNode.replaceChild(input, span); input.focus();
        var commit=function(){ onCommit(String(input.value||'')); };
        input.addEventListener('keydown', function(e){ if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); commit(); }});
        input.addEventListener('blur', commit);
      });
      return span;
    }
    function editableDateCell(value, onCommit){
      var span=document.createElement('span'); span.textContent=value||todayStr(); span.style.cursor='pointer'; span.title='Klik untuk ubah';
      span.addEventListener('click', function(){
        var input=document.createElement('input'); input.type='date'; input.className='input'; input.value=value||todayStr();
        span.parentNode.replaceChild(input, span); input.focus();
        var commit=function(){ onCommit(input.value||todayStr()); };
        input.addEventListener('keydown', function(e){ if(e.key==='Enter'){ e.preventDefault(); commit(); }});
        input.addEventListener('blur', commit);
      });
      return span;
    }

    // ===== Render main Tabel
    function render(){
      buildMonthFilter();
      var list=filtered().sort(function(a,b){ return (a.date>b.date?1:-1); });
      var tbody=$('#table tbody'); tbody.innerHTML='';
      list.forEach(function(e){
        var tr=document.createElement('tr');
        var tds=[
          (function(){ var td=document.createElement('td'); td.textContent = e.date; return td; })(),
          (function(){ var td=document.createElement('td'); td.textContent=getDayName(e.date); return td; })(),
          (function(){ var td=document.createElement('td'); td.className='mono right'; td.textContent = fmtIDR(e.harian); return td; })(),
          (function(){ var td=document.createElement('td'); td.className='mono right'; td.textContent = fmtIDR(e.jajanan); return td; })(),
          (function(){ var td=document.createElement('td'); td.className='mono right'; td.textContent = fmtIDR(e.jasa); return td; })(),
          (function(){ var td=document.createElement('td'); td.className='mono right'; td.textContent = fmtIDR(e.sewa); return td; })(),
          (function(){ var td=document.createElement('td'); td.className='mono right'; var tot=cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa); td.textContent=fmtIDR(tot); return td; })(),
          (function(){ var td=document.createElement('td'); td.textContent = e.catatan || ''; return td; })(),
          (function(){
            var td=document.createElement('td'); td.className='right';
            var edit=document.createElement('button'); edit.className='btn'; edit.textContent='Edit'; edit.title='Load rincian ke form atas';
            edit.onclick=function(){
              // Load this entry into the form + detail tables
              state.editingId = e.id;
              $('#addBtn').textContent = 'Simpan Perubahan'; document.getElementById('cancelEditBtn').style.display='inline-block';
              $('#date').value = e.date || todayStr();
              $('#harian').value = cleanNum(e.harian);
              $('#jajanan').value = cleanNum(e.jajanan);
              $('#jasa').value = cleanNum(e.jasa);
              $('#sewa').value = cleanNum(e.sewa);
              $('#catatan').value = e.catatan || '';
              $('#absenPagi').value = e.absenPagi || '';
              $('#absenSiang').value = e.absenSiang || '';
              $('#rukoBuka').value = e.rukoBuka || '';
              $('#rukoTutup').value = e.rukoTutup || '';
              applyDetails(e.details || null);

    // Pastikan Total terhitung ulang setelah edit
    try {
      sumRincian();
      sumJajanan3x10();
      sumJasa2x5();
      sumSewa3x10();
      if(window.sumGrandLive) window.sumGrandLive();
      updateRecap();
    } catch(err) { console.error('Recalc error after edit', err); }

    // Update field Hari setelah tanggal di-set
    if (typeof updateDayField === "function") {
        updateDayField();
    }
var actionsRow = document.getElementById('formActions');
if(actionsRow) actionsRow.classList.add('editing');
if(window.sumGrandLive) window.sumGrandLive(); updateRecap();
scrollToTopMobile();
              };
            td.appendChild(edit);
            var sp=document.createElement('span'); sp.style.display='inline-block'; sp.style.width='6px'; td.appendChild(sp);
            var del=document.createElement('button'); del.className='btn warn'; del.textContent='Hapus'; del.title='Hapus baris ini';
            
del.onclick = async function(){
     var entryDate = new Date(e.date);
     var today = new Date();
     var diffDays = Math.floor((today - entryDate) / (1000 * 60 * 60 * 24));

     if (diffDays >= 2) {
       var pwd = await themedPromptPassword({
         title: 'Verifikasi Hapus Data Lama',
         placeholder: 'Password admin'
       });
       if (pwd !== '381998') {
         await themedAlert('Tidak bisa hapus. Data lebih dari 2 hari memerlukan password yang benar.');
         return;
       }
     }

     if(await themedConfirm
('Hapus baris ini?')){ state.entries = state.entries.filter(function(it){ return it!==e; }); save(); render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    } } };
            td.appendChild(del); return td;
          })()
        ];
        tds.forEach(function(td){ tr.appendChild(td); }); tbody.appendChild(tr);
      });
      var sums=calcSums(list);
      $('#sumHarian').textContent=fmtIDR(sums.harian);
      $('#sumJajanan').textContent=fmtIDR(sums.jajanan);
      $('#sumJasa').textContent=fmtIDR(sums.jasa);
      $('#sumSewa').textContent=fmtIDR(sums.sewa);
      $('#sumTotal').textContent=fmtIDR(sums.total);

      var monthList = [];
    var monthSum;
if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);
    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var weekList = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    monthSum = calcSums(weekList).total;
} else if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // geser ke Senin
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);

    var list = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    var map = {};
    list.forEach(function(e){
        var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
        map[e.date] = (map[e.date]||0) + tot;
    });

    for (var dt = new Date(monday); dt <= sunday; dt.setDate(dt.getDate() + 1)) {
        var iso = new Date(dt.getTime() - dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
        data.push({date: iso, value: map[iso]||0});
    }

    if(caption) caption.textContent = 'Minggu ini: ' + from + ' s/d ' + to + ' â€¢ ' + data.length + ' hari';
} else if (state.filter === 'RENTANG' && state.range && (state.range.from || state.range.to)) {
    var from = state.range.from || '0000-01-01';
    var to   = state.range.to   || '9999-12-31';
    var rangeList = state.entries.filter(function(e){
        var d = e.date || '';
        return d && d >= from && d <= to;
    });
    monthSum = calcSums(rangeList).total;
} else {
    var monthPick = (state.filter==='ALL') ? monthKey(todayStr()) : state.filter;
    var monthList = state.entries.filter(function(x){ return monthKey(x.date)===monthPick; });
    monthSum = calcSums(monthList).total;
} var allSum=calcSums(state.entries).total;
      var _mt=$('#monthTotal'); if(_mt) _mt.textContent=fmtIDR(monthSum); var _at=$('#allTotal'); if(_at) _at.textContent=fmtIDR(allSum);
      // Fill new footer cells inside Riwayat
      var sm=document.getElementById('sumMonth'); if(sm) sm.textContent = fmtIDR(monthSum);
      var sa=document.getElementById('sumAll'); if(sa) sa.textContent = fmtIDR(allSum);

// === Kustom Footer Logic ===
(function(){
    var smEl = document.getElementById('sumMonth');
    var saRow = null;
    document.querySelectorAll('#table tfoot tr').forEach(function(tr){
        if(tr.textContent.trim().toLowerCase().includes('total semua')){
            saRow = tr;
        }
    });
    // Reset visibility
    if(saRow) saRow.style.display = '';
    if(smEl){
        var labelCell = smEl.closest('tr').querySelector('td[colspan="6"]');
        if(state.filter === "WEEK"){
            if(labelCell) labelCell.textContent = "Total Minggu Ini";
        } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
            if(labelCell) labelCell.textContent = "Total Bulan Ini";
        }
    }

    if(state.filter === 'RENTANG'){
        if(state.range && (state.range.from || state.range.to)){
            var from = state.range.from || '0000-01-01';
            var to   = state.range.to   || '9999-12-31';
            var rangeList = state.entries.filter(function(e){
                var d = e.date || '';
                return d && d >= from && d <= to;
            });
            var rangeSum = calcSums(rangeList).total;
            if(smEl) smEl.textContent = fmtIDR(rangeSum);
        }
        if(smEl){
            var labelCell = smEl.closest('tr').querySelector('td[colspan="6"]');
            if(labelCell) labelCell.textContent = 'Total Rentang';
        }
        if(saRow) saRow.style.display = 'none';
    } else if(state.filter !== 'ALL'){
        // Filter bulan: sembunyikan Total Semua
        if(saRow) saRow.style.display = 'none';
    }
})();

      var totalLabelEl = document.querySelector('#table tfoot tr.total-row td[colspan="5"]');
      if (totalLabelEl) {
        totalLabelEl.textContent = (state.filter === 'RENTANG') ? 'Total rentang' : 'Total bulan ini';
      }

      // Per-column Bulan sums
      var monthCols = calcSums(monthList);
      var allCols = calcSums(state.entries);
      var mapIds = {
        'sumHarianMonth': monthCols.harian,
        'sumJajananMonth': monthCols.jajanan,
        'sumJasaMonth': monthCols.jasa,
        'sumSewaMonth': monthCols.sewa,
        'sumHarianAll': allCols.harian,
        'sumJajananAll': allCols.jajanan,
        'sumJasaAll': allCols.jasa,
        'sumSewaAll': allCols.sewa
      };
      Object.keys(mapIds).forEach(function(id){
        var el = document.getElementById(id);
        if(el){ el.textContent = fmtIDR(mapIds[id]); }
      });

      var sm=document.getElementById('sumMonth'); if(sm) sm.textContent = fmtIDR(monthSum);
      var sa=document.getElementById('sumAll'); if(sa) sa.textContent = fmtIDR(allSum);

// === Kustom Footer Logic ===
(function(){
    var smEl = document.getElementById('sumMonth');
    var saRow = null;
    document.querySelectorAll('#table tfoot tr').forEach(function(tr){
        if(tr.textContent.trim().toLowerCase().includes('total semua')){
            saRow = tr;
        }
    });
    // Reset visibility
    if(saRow) saRow.style.display = '';
    if(smEl){
        var labelCell = smEl.closest('tr').querySelector('td[colspan="6"]');
        if(state.filter === "WEEK"){
            if(labelCell) labelCell.textContent = "Total Minggu Ini";
        } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
            if(labelCell) labelCell.textContent = "Total Bulan Ini";
        }
    }

    if(state.filter === 'RENTANG'){
        if(state.range && (state.range.from || state.range.to)){
            var from = state.range.from || '0000-01-01';
            var to   = state.range.to   || '9999-12-31';
            var rangeList = state.entries.filter(function(e){
                var d = e.date || '';
                return d && d >= from && d <= to;
            });
            var rangeSum = calcSums(rangeList).total;
            if(smEl) smEl.textContent = fmtIDR(rangeSum);
        }
        if(smEl){
            var labelCell = smEl.closest('tr').querySelector('td[colspan="6"]');
            if(labelCell) labelCell.textContent = 'Total Rentang';
        }
        if(saRow) saRow.style.display = 'none';
    } else if(state.filter !== 'ALL'){
        // Filter bulan: sembunyikan Total Semua
        if(saRow) saRow.style.display = 'none';
    }
})();

      var totalLabelEl = document.querySelector('#table tfoot tr.total-row td[colspan="5"]');
      if (totalLabelEl) {
        totalLabelEl.textContent = (state.filter === 'RENTANG') ? 'Total rentang' : 'Total bulan ini';
      }

      if(window.sumGrandLive) window.sumGrandLive(); updateRecap();
      try{ drawDailyGraph(); }catch(e){ /* ignore */ }
    }

    // ===== Tambah or Update entry from form
    function entryFromForm(){
      return {
        id: state.editingId || ID(),
        date: $('#date').value || todayStr(),
        harian: cleanNum($('#harian').value),
        jajanan: cleanNum($('#jajanan').value),
        jasa: cleanNum($('#jasa').value),
        sewa: cleanNum($('#sewa').value),
        catatan: ($('#catatan').value||'').trim(),
        absenPagi: $('#absenPagi').value || '',
        absenSiang: $('#absenSiang').value || '',
        rukoBuka: $('#rukoBuka').value || '',
        rukoTutup: $('#rukoTutup').value || '',
        details: collectDetails()
      };
    }
    async function addOrUpdateEntry(){

  // Validasi input wajib
  var absenPagi = document.getElementById('absenPagi').value;
  var absenSiang = document.getElementById('absenSiang').value;
  var rukoBuka = document.getElementById('rukoBuka').value;
  var rukoTutup = document.getElementById('rukoTutup').value;

  if(!absenPagi || !absenSiang || !rukoBuka || !rukoTutup){
    await themedAlert('Absen Pagi, Absen Siang, Ruko Buka, dan Ruko Tutup wajib diisi.');
    return;
  }
      // Guard: don't Simpan empty forms
      if(formIsTrulyEmpty()){
        await themedAlert('Form masih kosong. Isi setidaknya satu nilai atau rincian sebelum menyimpan.');
        return;
      }
      var newEntry = entryFromForm();
      if(state.editingId){
        var idx = state.entries.findIndex(function(x){ return x.id===state.editingId; });
        if(idx>=0) state.entries[idx] = newEntry;
state.editingId = null;
$('#addBtn').textContent = '+ Tambah Pencatatan';
document.getElementById('cancelEditBtn').style.display='none';
var actionsRow = document.getElementById('formActions');
if(actionsRow) actionsRow.classList.remove('editing');
      }else{
        state.entries.push(newEntry);
      }
      save(); clearForm(); render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }
    }

    function clearForm(){
      ['harian','jajanan','jasa','sewa','catatan'].forEach(function(id){ var el=$('#'+id); if(el) el.value=''; });
            $all('#rincianTable .r-jenis').forEach(function(sel){ sel.value = ''; });
      $('#date').value=todayStr();
      ['absenPagi','absenSiang','rukoBuka','rukoTutup'].forEach(function(id){var el=document.getElementById(id); if(el) el.value='';});
      $all('#rincianTable input, #jajananTable3x10 input, #jajananTable3x10 select, #jasaTable2x5 input, #jasaTable2x5 select, #sewaTable3x10 input, #sewaTable3x10 select').forEach(function(i){ i.value=''; });
      $('#rincianTotal').textContent=fmtIDR(0); $('#jajananTotal3x10').textContent=fmtIDR(0); $('#jasaTotal2x5').textContent=fmtIDR(0); $('#sewaTotal3x10').textContent=fmtIDR(0);
      if(window.sumGrandLive) window.sumGrandLive(); updateRecap();
      try{ drawDailyGraph(); }catch(e){ /* ignore */ }
    }

    // ===== CSV (aggregates only)
    window.exportCSV = function(){
      var header=['tanggal','harian','jajanan','jasa_aksesoris','sewa_ps','total','catatan'];
      var rows=state.entries.map(function(e){
        var tot=cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
        var cat=String(e.catatan||'').split('"').join("''");
        return [e.date,cleanNum(e.harian),cleanNum(e.jajanan),cleanNum(e.jasa),cleanNum(e.sewa),tot,cat].join(',');
      });
      var csv=[header.join(','),rows.join('\\n')].join('\\n');
      var blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});
      var url=URL.createObjectURL(blob); var a=document.createElement('a'); a.href=url; a.download='pembukuan_rental_ps_'+Date.now()+'.csv'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(function(){ URL.revokeObjectURL(url); },1500);
    }
    function importCSV(file){
      var reader=new FileReader();
      reader.onload=async function(ev){
        var text=ev.target.result||''; var lines=text.split(/\\r?\\n/); if(lines.length<2){ await themedAlert('CSV kosong atau tidak valid.'); return; }
        for(var i=1;i<lines.length;i++){
          var line=lines[i]; if(!line) continue; var p=line.split(',');
          var obj={ id:ID(), date:(p[0]||'').trim(), harian:cleanNum(p[1]), jajanan:cleanNum(p[2]), jasa:cleanNum(p[3]), sewa:cleanNum(p[4]), catatan:(p[6]||'').trim(), details:null };
          if(obj.date){ state.entries.push(obj); }
        }
        save(); render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }
      };
      reader.readAsText(file);
    }

    // ===== Tangkapan Layar (full page)
    function takeFullScreenshot(){
      var btn=$('#screenshotBtn'); var prev=btn?btn.style.visibility:''; if(btn) btn.style.visibility='hidden';
      var w=Math.max(document.documentElement.scrollWidth, document.body.scrollWidth);
      var h=Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
      window.scrollTo(0,0);
      html2canvas(document.body,{useCORS:true,backgroundColor:getComputedStyle(document.body).backgroundColor,windowWidth:w,windowHeight:h,scale:2}).then(function(canvas){
        var dataURL=canvas.toDataURL('image/png'); var a=document.createElement('a');
        var now=new Date(); var pad=function(n){return (n<10?'0':'')+n;}
        a.href=dataURL; a.download='screenshot_urban_ps_'+now.getFullYear()+'-'+pad(now.getMonth()+1)+'-'+pad(now.getDate())+'_'+pad(now.getHours())+pad(now.getMinutes())+pad(now.getSeconds())+'.png';
        document.body.appendChild(a); a.click(); a.remove(); if(btn) btn.style.visibility=prev;
      }).catch(async function(err){ if(btn) btn.style.visibility=prev; await themedAlert('Gagal screenshot: '+err.message); });
    }

    // ===== Events

// ===== Events (basic Konfirmasi, no animations, no Kustom Jendela Dialog)
document.getElementById('addBtn').addEventListener('click', async function(){
  try {
    if (typeof formIsTrulyEmpty === 'function' && formIsTrulyEmpty()) {
      await themedAlert('Form masih kosong. Isi setidaknya satu nilai atau rincian sebelum menyimpan.');
      return;
    }
    var ok = await themedConfirm('Apakah pembukuan sudah di-screenshot?\nJika tekan OK data akan disimpan.');
    if (ok) addOrUpdateEntry();
  } catch (err) {
    await themedAlert('Gagal menyimpan: ' + err.message);
  }
});

        ['harian','jajanan','jasa','sewa'].forEach(function(id){ $('#'+id).addEventListener('input', function(){ if(window.sumGrandLive) window.sumGrandLive(); updateRecap(); }); });
    ['harian','jajanan','jasa','sewa','catatan'].forEach(function(id){ $('#'+id).addEventListener('keydown', function(e){ if(e.key==='Enter'){ addOrUpdateEntry(); }}); });
    $('#monthFilter').addEventListener('change', function(e){
      state.filter = e.target.value;
      setRangeControlsEnabled(state.filter==='RENTANG');
      render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }

      // tampilkan / sembunyikan section Rentang
      var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
      if(rentangRow){
        rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
      }

    // === Weekly auto-reset ===
    (function(){
      try {
        var today = new Date();
        var isMonday = today.getDay() === 1; // Monday=1
        var todayStrIso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var lastReset = localStorage.getItem('urban_ps_week_reset') || '';
        if(isMonday && lastReset !== todayStrIso){
          state.filter = 'WEEK';
          localStorage.setItem('urban_ps_week_reset', todayStrIso);
          setTimeout(function(){
            themedAlert('Filter Mingguan sudah direset karena hari Senin.');
          }, 300);
        }
        // Default ke WEEK jika tidak ada Filter lain diset
        if(!state.filter){
          state.filter = 'WEEK';
        }
      } catch(e){ console.error('Weekly reset error', e); }
    })();

    setRangeControlsEnabled(state.filter==='RENTANG');
    });
    
    
    $('#clearBtn').addEventListener('click', async function(){
  // Kata Sandi + Konfirmasi flow (Tema-matched Jendela Dialog)
  const ADMIN_PASSWORD = '381998';
  var pwd = await themedPromptPassword({
    title: 'Verifikasi Hapus Data',
    placeholder: 'Password admin'
  });
  if (pwd === null) return; // closed/cancelled
  if (pwd !== ADMIN_PASSWORD){
    await themedAlert('Password salah. Aksi dibatalkan.');
    return;
  }
  if (await themedConfirm('Hapus SEMUA data?')){
    state.entries = [];
    save();
    render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }

    // === Weekly auto-reset ===
    (function(){
      try {
        var today = new Date();
        var isMonday = today.getDay() === 1; // Monday=1
        var todayStrIso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var lastReset = localStorage.getItem('urban_ps_week_reset') || '';
        if(isMonday && lastReset !== todayStrIso){
          state.filter = 'WEEK';
          localStorage.setItem('urban_ps_week_reset', todayStrIso);
          setTimeout(function(){
            themedAlert('Filter Mingguan sudah direset karena hari Senin.');
          }, 300);
        }
        // Default ke WEEK jika tidak ada Filter lain diset
        if(!state.filter){
          state.filter = 'WEEK';
        }
      } catch(e){ console.error('Weekly reset error', e); }
    })();

    setRangeControlsEnabled(state.filter==='RENTANG');
    await themedAlert('Semua data dihapus.');
  }
});
    
document.addEventListener('click', function(e){
    if(e.target && e.target.id === 'exportReportBtn'){
        exportReportPDF();
    }
});


// Ubah label tombol
document.getElementById('exportReportBtn').textContent = "ðŸ“ Download Laporan";

document.getElementById('exportReportBtn').addEventListener('click', function(){
    exportReportPDF();
});








async function exportReportPDF(){
    try {
        // === 1. Cek Absen & Jam Ruko ===
        var absenPagi = document.getElementById('absenPagi').value;
        var absenSiang = document.getElementById('absenSiang').value;
        var rukoBuka = document.getElementById('rukoBuka').value;
        var rukoTutup = document.getElementById('rukoTutup').value;

        if(!absenPagi || !absenSiang || !rukoBuka || !rukoTutup){
            await themedAlert("âš ï¸ Absen Pagi, Absen Siang, Ruko Buka, dan Ruko Tutup wajib diisi sebelum download laporan.");
            return; // stop
        }

        // === 2. Cek Rincian ===
        var details = collectDetails();
        if(detailsIsEmpty(details)){
            await themedAlert("âš ï¸ Minimal isi 1 data rincian sebelum download laporan.");
            return; // stop
        }

        // === 3. Generate PDF ===
        const { jsPDF } = window.jspdf;
        var w = Math.max(document.documentElement.scrollWidth, document.body.scrollWidth);
        var h = Math.max(document.documentElement.scrollHeight, document.body.scrollHeight);
        window.scrollTo(0,0);

        const canvas = await html2canvas(document.body, {
            useCORS: true,
            backgroundColor: getComputedStyle(document.body).backgroundColor,
            windowWidth: w,
            windowHeight: h,
            scale: 1.2
        });

        const imgData = canvas.toDataURL('image/jpeg', 0.85);
        const pdf = new jsPDF('p', 'pt', [canvas.width * 0.75, canvas.height * 0.75]);
        pdf.addImage(imgData, 'JPEG', 0, 0, canvas.width * 0.75, canvas.height * 0.75);

        // Nama file berdasarkan tanggal & hari
        const tanggalInput = document.getElementById('date').value;
        const hariInput = document.getElementById('day').value || '';
        let fileName = tanggalInput 
            ? `pembukuan_URBAN_LPG_${tanggalInput}_${hariInput}.pdf`
            : `pembukuan_URBAN_LPG_${new Date().toISOString().slice(0,10)}.pdf`;

        // ==== SHARE SHEET ====
        const pdfBlob = pdf.output('blob');
        const file = new File([pdfBlob], fileName, { type: 'application/pdf' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            await navigator.share({
                title: "Laporan Pembukuan",
                text: "Berikut laporan pembukuan dalam format PDF.",
                files: [file]
            }).then(() => {
                themedAlertCustom("âœ… Laporan berhasil dibagikan. Klik + Tambah Pencatatan supaya catatan do save.", {
                    okText: "+ Tambah Pencatatan",
                    onOk: async function(){
                        await addOrUpdateEntry();
                        setTimeout(() => {
                            themedAlertCustom("âœ… Laporan hari ini sudah berhasil ditambahkan.", {
                                okText: "Tutup"
                            });
                        }, 250);
                    }
                });
            }).catch(err => console.warn("Share dibatalkan/gagal:", err));
            return;
        }

        // ==== Fallback Download ====
        const url = URL.createObjectURL(pdfBlob);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(url), 1500);

        themedAlertCustom("âœ… Laporan berhasil diunduh. Klik + Tambah Pencatatan supaya catatan do save.", {
            okText: "+ Tambah Pencatatan",
            onOk: async function(){
                await addOrUpdateEntry();
                setTimeout(() => {
                    themedAlertCustom("âœ… Laporan hari ini sudah berhasil ditambahkan.", {
                        okText: "Tutup"
                    });
                }, 250);
            }
        });

    } catch(err){
        await themedAlert('Gagal download laporan: ' + err.message);
    }
}










    
    
    

// === Pengaturan Jendela Dialog Logic ===
(function(){
  var backdrop = document.getElementById('popupBackdrop');
  var settingsModal = document.getElementById('settingsModal');

  function showSettingsModal(){
    backdrop.hidden = false;
    settingsModal.hidden = false;
    requestAnimationFrame(function(){
      backdrop.classList.add('is-visible');
      settingsModal.classList.add('is-visible');
    });
  }
  function hideSettingsModal(){
    backdrop.classList.remove('is-visible');
    settingsModal.classList.remove('is-visible');
    setTimeout(function(){
      backdrop.hidden = true;
      settingsModal.hidden = true;
    }, 200);
  }

  document.getElementById('settingsBtn').addEventListener('click', function(){
    showSettingsModal();

    // Setup Tema Tombol Pilih Tombol each time Pengaturan Jendela Dialog is opened
    var themeBtnInSettings = document.getElementById('themeToggleInSettings');
    if(themeBtnInSettings){
      function updateThemeBtnText(){
        var currentTheme = getTheme();
        themeBtnInSettings.textContent = (currentTheme === 'light') ? 'â˜€ï¸ Terang' : 'ðŸŒ™ Gelap';
      }
      updateThemeBtnText();
      themeBtnInSettings.onclick = function(){
        var cur = getTheme();
        setTheme(cur === 'light' ? 'dark' : 'light');
        updateThemeBtnText();
      };
    }
  });

  // Tutup buttons inside Jendela Dialog
  settingsModal.querySelectorAll('[data-close]').forEach(function(btn){
    btn.addEventListener('click', hideSettingsModal);
  });

  // Navigate to Item Jajanan Pengaturan
  document.getElementById('openJajananSettings').addEventListener('click', function(){
    hideSettingsModal();
    setTimeout(function(){
      if (typeof showJajananSettingsModal === 'function') {
        showJajananSettingsModal();

      } else if (state.filter === 'WEEK') {
        var today = new Date();
        var day = today.getDay(); // 0=Sunday, 1=Monday
        var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
        var monday = new Date(today);
        monday.setDate(today.getDate() + diff);
        var sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        list = state.entries.filter(function(e){ return e.date >= from && e.date <= to; });

      } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
        console.error('showJajananSettingsModal function not found.');
      }
    }, 220); // wait for animation
  });
})();


// Range Filter events (Kustom date range)
    ;(function(){
      var _from = document.getElementById('dateFrom');
      var _to = document.getElementById('dateTo');
      var _apply = document.getElementById('rangeApply');
      var _clear = document.getElementById('rangeClear');
      if(_apply){ _apply.addEventListener('click', function(){
        var f = _from && _from.value ? _from.value : '';
        var t = _to && _to.value ? _to.value : '';
        state.range = (f || t) ? {from:f, to:t} : null;
        render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }

    // === Weekly auto-reset ===
    (function(){
      try {
        var today = new Date();
        var isMonday = today.getDay() === 1; // Monday=1
        var todayStrIso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var lastReset = localStorage.getItem('urban_ps_week_reset') || '';
        if(isMonday && lastReset !== todayStrIso){
          state.filter = 'WEEK';
          localStorage.setItem('urban_ps_week_reset', todayStrIso);
          setTimeout(function(){
            themedAlert('Filter Mingguan sudah direset karena hari Senin.');
          }, 300);
        }
        // Default ke WEEK jika tidak ada Filter lain diset
        if(!state.filter){
          state.filter = 'WEEK';
        }
      } catch(e){ console.error('Weekly reset error', e); }
    })();

    setRangeControlsEnabled(state.filter==='RENTANG');
        try { drawDailyGraph(); } catch(e) {}
      }); }
      if(_clear){ _clear.addEventListener('click', function(){
        if(_from) _from.value='';
        if(_to) _to.value='';
        state.range = null;
        render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }

    // === Weekly auto-reset ===
    (function(){
      try {
        var today = new Date();
        var isMonday = today.getDay() === 1; // Monday=1
        var todayStrIso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var lastReset = localStorage.getItem('urban_ps_week_reset') || '';
        if(isMonday && lastReset !== todayStrIso){
          state.filter = 'WEEK';
          localStorage.setItem('urban_ps_week_reset', todayStrIso);
          setTimeout(function(){
            themedAlert('Filter Mingguan sudah direset karena hari Senin.');
          }, 300);
        }
        // Default ke WEEK jika tidak ada Filter lain diset
        if(!state.filter){
          state.filter = 'WEEK';
        }
      } catch(e){ console.error('Weekly reset error', e); }
    })();

    setRangeControlsEnabled(state.filter==='RENTANG');
        try { drawDailyGraph(); } catch(e) {}
      }); }
    })();


    // Cancel Edit Tombol
    (function(){
      var cbtn = document.getElementById('cancelEditBtn');
      if(cbtn){
        cbtn.addEventListener('click', function(){
  clearForm();
  try{
    clearForm();
    state.editingId = null;
    $('#addBtn').textContent = '+ Tambah Pencatatan';
    cbtn.style.display = 'none';
    var actionsRow = document.getElementById('formActions');
    if(actionsRow) actionsRow.classList.remove('editing');
          }catch(err){
            console.error('Cancel error:', err);
          }
        });
      }
    })();
// === Tambah Baris simple helpers ===
    function renumberAll(tbody){
      var rows = tbody.querySelectorAll('tr');
      rows.forEach(function(tr,i){
        var first = tr.querySelector('td:first-child');
        if(first) first.textContent = (i+1);
      });
    }

    function addRowRincian(){
      var tb = document.querySelector('#rincianTable tbody');
      var tr = document.createElement('tr');
      tr.innerHTML = '<td></td>' +
        '<td><select class="select mini r-jenis"><option value="">-</option><option>PS3</option><option>PS4</option></select></td>' +
        '<td><input type="time" class="input mini r-jam"/></td>' +
        '<td><input type="number" min="0" step="0.5" placeholder="0" class="input mono mini r-jumlah"/></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini rincian-harga r-harga"/></td>';
      tb.appendChild(tr);
      // wire pricing calc like initial
      (function(){
        var sel=tr.querySelector('.r-jenis'); var j=tr.querySelector('.r-jumlah'); var h=tr.querySelector('.r-harga');
        function rec(){ var RENTAL_RATE={ PS3:{hour:5000,half:3000}, PS4:{hour:7000,half:4000} }; var ps=sel.value; var r=RENTAL_RATE[ps]; var n=parseFloat(j.value); var price=0; if(r && !isNaN(n) && n>0){ var whole=Math.floor(n); var rem=Math.round((n-whole)*10)/10; price=whole*r.hour; if(Math.abs(rem-0.5)<0.001) price+=r.half; else if(rem>0) price+=Math.round(rem*r.hour);} h.value=price?String(price):''; sumRincian(); }
        sel.addEventListener('change', rec); j.addEventListener('input', rec); h.addEventListener('input', sumRincian);
      })();
      renumberAll(tb);
    }

    function addRowJajanan3x10(){
      var tb = document.querySelector('#jajananTable3x10 tbody');
      var items = Object.keys(JAJ_PRICE||{});
      var tr = document.createElement('tr');
      tr.innerHTML = '<td></td>' +
        '<td><select class="select mini j3-jenis"><option value="">-</option>'+items.map(function(x){return '<option>'+x+'</option>';}).join('')+'</select></td>' +
        '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
            '<input type="number" min="0" step="1" placeholder="0" class="input mono mini j3-qty"/>' +
            '<input type="time" class="input mini j3-jam"/></div></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" readonly class="input mono mini j3-harga"/></td>';
      tb.appendChild(tr);
      // wire price calc
      (function(){
        var sel=tr.querySelector('.j3-jenis'), qty=tr.querySelector('.j3-qty'), harga=tr.querySelector('.j3-harga');
        function recalc(){ var unit=JAJ_PRICE[sel.value]||0; var q=cleanNum(qty.value); harga.value=unit*q; sumJajanan3x10(); }
        sel.addEventListener('change', recalc); qty.addEventListener('input', recalc);
      })();
      renumberAll(tb);
    }

    function addRowJasa2x5(){
      var tb = document.querySelector('#jasaTable2x5 tbody');
      var tr = document.createElement('tr');
      tr.innerHTML = '<td></td>' +
        '<td><select class="select mini jasa-type"><option value="">-</option>'+JASA_TYPES.map(function(x){return '<option>'+x+'</option>';}).join('')+'</select></td>' +
        '<td><input type="text" class="input mini jasa-note" placeholder="keterangan (opsional)"/></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini jasa-price"/></td>';
      tb.appendChild(tr);
      tr.querySelector('.jasa-price').addEventListener('input', sumJasa2x5);
      renumberAll(tb);
    }

    function addRowSewa3x10(){
      var tb = document.querySelector('#sewaTable3x10 tbody');
      var tr = document.createElement('tr');
      tr.innerHTML = '<td></td>' +
        '<td><select class="select mini sewa-jenis"><option value="">-</option>'+SEWA_TYPES.map(function(x){return '<option>'+x+'</option>';}).join('')+'</select></td>' +
        '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
            '<select class="select mini sewa-durasi"><option value="">-</option><option value="12JAM">12 JAM</option><option value="1HARI">1 HARI</option><option value="2HARI">2 HARI</option><option value="3HARI">3 HARI</option></select>' +
            '<input type="text" placeholder="Isi Sendiri" class="input mini sewa-manual"/></div></td>' +
        '<td><input type="text" placeholder="note (optional)" class="input mini sewa-lama-note"/></td><td><input type="number" min="0" step="1000" placeholder="0" class="input mono mini sewa-harga"/></td>';
      tb.appendChild(tr);
      (function(){
        var selJ=tr.querySelector('.sewa-jenis'); var selD=tr.querySelector('.sewa-durasi'); var inM=tr.querySelector('.sewa-manual'); var inH=tr.querySelector('.sewa-harga');
        function recalc(){
  var manualVal = (inM.value || '').trim();
  if(manualVal){
    // User filled 'Isi Sendiri', skip auto calculation entirely
    return;
  }
  var jam = hoursFromDurasiSelect(selD.value, '');
  var price = calcSewaPrice(selJ.value, jam);
  if(price>0){ inH.value = price; }
  else { inH.value=''; }
  sumSewa3x10();
}
        selJ.addEventListener('change', recalc); selD.addEventListener('change', recalc); inM.addEventListener('input', recalc); inH.addEventListener('input', sumSewa3x10);
      })();
      renumberAll(tb);
    }

    // Bind buttons
    (function(){
      var b1 = document.getElementById('rincianAddRow'); if(b1) b1.addEventListener('click', addRowRincian);
      var b2 = document.getElementById('jajanan3x10AddRow'); if(b2) b2.addEventListener('click', addRowJajanan3x10);
      var b3 = document.getElementById('jasa2x5AddRow'); if(b3) b3.addEventListener('click', addRowJasa2x5);
      var b4 = document.getElementById('sewa3x10AddRow'); if(b4) b4.addEventListener('click', addRowSewa3x10);
    })();

    

    // === Hapus Baris helpers ===
    async function removeRow(tbodySelector) {
      var tb = document.querySelector(tbodySelector + ' tbody');
      if (!tb || tb.rows.length === 0) return;

      var lastRow = tb.rows[tb.rows.length - 1];
      var hasData = false;
      lastRow.querySelectorAll('input, select').forEach(function(el) {
        if (el.value && String(el.value).trim() !== '') hasData = true;
      });

      if (!hasData || await themedConfirm('Baris ini berisi data. Yakin ingin menghapusnya?')) {
        tb.deleteRow(tb.rows.length - 1);
        renumberAll(tb);
        if (tbodySelector.indexOf('rincianTable') !== -1) sumRincian();
        if (tbodySelector.indexOf('jajananTable3x10') !== -1) sumJajanan3x10();
        if (tbodySelector.indexOf('jasaTable2x5') !== -1) sumJasa2x5();
        if (tbodySelector.indexOf('sewaTable3x10') !== -1) sumSewa3x10();
      }
    }

    // Tambah "Hapus Baris" buttons beside each "Tambah Baris" Tombol
    (function(){
      function addRemoveBtn(afterId, handler){
        var addBtn = document.getElementById(afterId);
        if(!addBtn) return;
        var btn = document.createElement('button');
        btn.className = 'btn warn remove-row';
        btn.textContent = '- Hapus Baris';
        btn.type = 'button';
        btn.style.marginLeft = '6px';
        btn.addEventListener('click', handler);
        if (addBtn.after) addBtn.after(btn);
        else addBtn.parentNode.insertBefore(btn, addBtn.nextSibling);
      }

      addRemoveBtn('rincianAddRow', async function(){ await removeRow('#rincianTable'); });
      addRemoveBtn('jajanan3x10AddRow', async function(){ await removeRow('#jajananTable3x10'); });
      addRemoveBtn('jasa2x5AddRow', async function(){ await removeRow('#jasaTable2x5'); });
      addRemoveBtn('sewa3x10AddRow', async function(){ await removeRow('#sewaTable3x10'); });
    })();

// ===== Init
    $('#year').textContent=(new Date()).getFullYear();
          $all('#rincianTable .r-jenis').forEach(function(sel){ sel.value = ''; });
      $('#date').value=todayStr();
    load();
    // Build tables
    (function initTables(){
      // Rincian
      (function(){ var rincianBody = $('#rincianTable tbody'); rincianBody.innerHTML=''; for(var i=1;i<=10;i++){ var tr=document.createElement('tr'); tr.innerHTML = '<td>'+i+'</td><td><select class="select mini r-jenis"><option value="">-</option><option>PS3</option><option>PS4</option></select></td><td><input type="time" class="input mini r-jam"/></td><td><input type="number" min="0" step="0.5" placeholder="0" class="input mono mini r-jumlah"/></td><td><input type="number" min="0" step="100" placeholder="0" class="input mono mini rincian-harga r-harga"/></td>'; $('#rincianTable tbody').appendChild(tr);} })();
      // wire
      (function(){ $all('#rincianTable tbody tr').forEach(function(tr){ var sel=tr.querySelector('.r-jenis'); var j=tr.querySelector('.r-jumlah'); var h=tr.querySelector('.r-harga'); function rec(){ var RENTAL_RATE={ PS3:{hour:5000,half:3000}, PS4:{hour:7000,half:4000} }; var ps=sel.value; var r=RENTAL_RATE[ps]; var n=parseFloat(j.value); var price=0; if(r && !isNaN(n) && n>0){ var whole=Math.floor(n); var rem=Math.round((n-whole)*10)/10; price=whole*r.hour; if(Math.abs(rem-0.5)<0.001) price+=r.half; else if(rem>0) price+=Math.round(rem*r.hour);} h.value=price?String(price):''; sumRincian(); } sel.addEventListener('change', rec); j.addEventListener('input', rec); }); $all('.r-harga').forEach(function(inp){ inp.addEventListener('input', sumRincian); }); })();
      // Jajanan
      buildJajanan3x10();
      // Jasa
      buildJasa2x5();
      // Sewa
      buildSewa3x10();
    })();

    sumRincian(); sumJajanan3x10(); sumJasa2x5(); sumSewa3x10();
    render();
// tampilkan/sembunyikan input Kustom bulan
var customRow = document.getElementById('customMonthRow');
if(state.filter === 'CUSTOM_MONTH'){
  if(customRow) customRow.style.display = '';
} else {
  if(customRow) customRow.style.display = 'none';
}

    // atur visibilitas Rentang sesuai Filter awal
    var rentangRow = document.querySelector('label[for="dateFrom"]').parentElement;
    if(rentangRow){
      rentangRow.style.display = (state.filter === 'RENTANG') ? '' : 'none';
    }

    // === Weekly auto-reset ===
    (function(){
      try {
        var today = new Date();
        var isMonday = today.getDay() === 1; // Monday=1
        var todayStrIso = new Date(today.getTime() - today.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var lastReset = localStorage.getItem('urban_ps_week_reset') || '';
        if(isMonday && lastReset !== todayStrIso){
          state.filter = 'WEEK';
          localStorage.setItem('urban_ps_week_reset', todayStrIso);
          setTimeout(function(){
            themedAlert('Filter Mingguan sudah direset karena hari Senin.');
          }, 300);
        }
        // Default ke WEEK jika tidak ada Filter lain diset
        if(!state.filter){
          state.filter = 'WEEK';
        }
      } catch(e){ console.error('Weekly reset error', e); }
    })();

    setRangeControlsEnabled(state.filter==='RENTANG');
updateRecap();
var actionsRow=document.getElementById('formActions');
if(actionsRow) actionsRow.classList.remove('editing');
if(window.sumGrandLive) window.sumGrandLive();
updateRecap();

    // ===== Harian Grafik (per-Bulan line chart) =====
    var graphCtx = null, graphCanvas = null, graphTooltip = null;
    function colorForValue(v){
      if(v > 200000) return '#2ecc71'; // green
      if(v > 150000) return '#2980b9'; // blue
      if(v > 100000) return '#f1c40f'; // yellow
      return '#e74c3c';                // red
    }
    function ensureTooltip(){
      if(graphTooltip) return graphTooltip;
      var div = document.createElement('div');
      div.className = 'graph-tooltip';
      div.style.position = 'absolute';
      div.style.display = 'none';
      document.body.appendChild(div);
      graphTooltip = div;
      return div;
    }
    
function getMonthlySeries(){
  // Rentang mode â†’ build directly from range
  if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);
    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var weekList = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    monthSum = calcSums(weekList).total;
} else if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay(); // 0=Sunday, 1=Monday
    var diff = (day === 0 ? -6 : 1 - day); // geser ke Senin
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);

    var list = state.entries.filter(function(e){
        return e.date >= from && e.date <= to;
    });
    var map = {};
    list.forEach(function(e){
        var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
        map[e.date] = (map[e.date]||0) + tot;
    });

    for (var dt = new Date(monday); dt <= sunday; dt.setDate(dt.getDate() + 1)) {
        var iso = new Date(dt.getTime() - dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
        data.push({date: iso, value: map[iso]||0});
    }

    if(caption) caption.textContent = 'Minggu ini: ' + from + ' s/d ' + to + ' â€¢ ' + data.length + ' hari';
} else if (state.filter === 'RENTANG' && state.range && (state.range.from || state.range.to)) {
    var from = state.range.from || '0000-01-01';
    var to   = state.range.to   || '9999-12-31';
    var list = state.entries.filter(function(e){
      var d = e.date || '';
      return d && d >= from && d <= to;
    });

    // Map date â†’ Total
    var map = {};
    list.forEach(function(e){
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    // Generate all days from 'from' to 'to'
    var data = [];
    var start = new Date(from);
    var end = new Date(to);
    for (var dt = new Date(start); dt <= end; dt.setDate(dt.getDate() + 1)) {
      var iso = new Date(dt.getTime() - dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
      data.push({date: iso, value: map[iso]||0});
    }
    return { month: from + ' s/d ' + to, rows: data };
  }

  // fallback to monthly behaviour
  var monthPick = (state.filter==='ALL') ? (new Date().toISOString().slice(0,7)) : state.filter;
  var list = state.entries.filter(function(x){ return (x.date||'').slice(0,7) === monthPick; });
  var map = {};
  list.forEach(function(e){
    var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
    map[e.date] = (map[e.date]||0) + tot;
  });
  var p = monthPick.split('-');
  var y = +p[0], m = (+p[1])-1;
  var last = new Date(y, m+1, 0);
  var data = [];
  for(var d=1; d<=last.getDate(); d++){
    var dt = new Date(y, m, d);
    var iso = new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
    data.push({date: iso, value: map[iso]||0});
  }
  return { month: monthPick, rows: data };
}


function drawDailyGraph(){
  graphCanvas = document.getElementById('dailyGraph');
  if(!graphCanvas) return;
  var rect = graphCanvas.getBoundingClientRect();
  var dpr = window.devicePixelRatio || 1;
  var cssW = graphCanvas.clientWidth || rect.width || 800;
  var cssH = graphCanvas.clientHeight || 260;
  graphCanvas.width = Math.round(cssW * dpr);
  graphCanvas.height = Math.round(cssH * dpr);
  graphCanvas.style.width = cssW + 'px';
  graphCanvas.style.height = cssH + 'px';
  graphCtx = graphCanvas.getContext('2d');
  graphCtx.setTransform(dpr, 0, 0, dpr, 0, 0);

  var data = [];
  var caption = document.getElementById('graphCaption');

  // === WEEK MODE ===
  if (state.filter === 'WEEK') {
    var today = new Date();
    var day = today.getDay();
    var diff = (day === 0 ? -6 : 1 - day);
    var monday = new Date(today);
    monday.setDate(today.getDate() + diff);
    var sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
    var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);

    var list = state.entries.filter(e => e.date >= from && e.date <= to);
    var map = {};
    list.forEach(e => {
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    for (var dt = new Date(monday); dt <= sunday; dt.setDate(dt.getDate() + 1)) {
      var iso = new Date(dt.getTime() - dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
      data.push({date: iso, value: map[iso]||0});
    }

    if(caption) caption.textContent = 'Minggu ini: ' + from + ' s/d ' + to + ' â€¢ ' + data.length + ' hari';
  }

  // === Rentang MODE ===
  else if (state.filter === 'RENTANG' && state.range && (state.range.from || state.range.to)) {
    var from = state.range.from || '0000-01-01';
    var to   = state.range.to   || '9999-12-31';
    var list = state.entries.filter(e => e.date && e.date >= from && e.date <= to);

    var map = {};
    list.forEach(e => {
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    for (var dt = new Date(from); dt <= new Date(to); dt.setDate(dt.getDate()+1)) {
      var iso = new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
      data.push({date: iso, value: map[iso]||0});
    }
    if(caption) caption.textContent = 'Periode: ' + from + ' s/d ' + to + ' â€¢ ' + data.length + ' hari';
  }

  // === ALL MODE ===
  else if (state.filter === 'ALL') {
    var map = {};
    state.entries.forEach(e => {
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    var dates = Object.keys(map).sort();
    data = dates.map(d => ({date: d, value: map[d]}));

    if(caption && dates.length){
      caption.textContent = 'Semua Bulan: ' + dates[0] + ' s/d ' + dates[dates.length-1] + ' â€¢ ' + data.length + ' hari';
    }
  }

  // === Kustom Bulan MODE ===
  else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
    var monthPick = state.customMonthValue; // misalnya "2025-08"
    var list = state.entries.filter(e => (e.date||'').slice(0,7) === monthPick);
    var map = {};
    list.forEach(e => {
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    var p = monthPick.split('-');
    var y = +p[0], m = (+p[1])-1;
    var last = new Date(y, m+1, 0);
    for(var d=1; d<=last.getDate(); d++){
      var dt = new Date(y, m, d);
      var iso = new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
      data.push({date: iso, value: map[iso]||0});
    }

    if(caption){
      try {
        var d = new Date(monthPick+'-01');
        caption.textContent = 'Periode: ' + d.toLocaleDateString('id-ID',{month:'long',year:'numeric'}) + ' â€¢ ' + data.length + ' hari';
      }catch(e){ caption.textContent = 'Periode: ' + monthPick; }
    }
  }

  // === BULAN MODE ===
  else {
    var monthPick = state.filter;
    var list = state.entries.filter(x => (x.date||'').slice(0,7) === monthPick);
    var map = {};
    list.forEach(e => {
      var tot = cleanNum(e.harian)+cleanNum(e.jajanan)+cleanNum(e.jasa)+cleanNum(e.sewa);
      map[e.date] = (map[e.date]||0) + tot;
    });

    var p = monthPick.split('-');
    var y = +p[0], m = (+p[1])-1;
    var last = new Date(y, m+1, 0);
    for(var d=1; d<=last.getDate(); d++){
      var dt = new Date(y, m, d);
      var iso = new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,10);
      data.push({date: iso, value: map[iso]||0});
    }
    if(caption){
      try {
        var d = new Date(monthPick+'-01');
        caption.textContent = 'Periode: ' + d.toLocaleDateString('id-ID',{month:'long',year:'numeric'}) + ' â€¢ ' + data.length + ' hari';
      }catch(e){ caption.textContent = 'Periode: ' + monthPick; }
    }
  }

  // === DRAW ===
  var maxV = 0;
  data.forEach(r => { if(r.value>maxV) maxV=r.value; });
  var padL = 48, padR = 12, padT = 16, padB = 42;
  var W = (graphCanvas.clientWidth||cssW), H = (graphCanvas.clientHeight||cssH);
  var plotW = Math.max(10, W - padL - padR);
  var plotH = Math.max(10, H - padT - padB);
  function xAt(i){ return padL + (plotW * (i/(Math.max(1,data.length-1)))) }
  function yAt(v){ return padT + plotH - (maxV>0 ? (v/maxV)*plotH : 0); }

  graphCtx.clearRect(0,0,W,H);
  graphCtx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--ring') || '#334';
  graphCtx.lineWidth = 1;
  graphCtx.beginPath();
  graphCtx.moveTo(padL, padT);
  graphCtx.lineTo(padL, padT+plotH);
  graphCtx.lineTo(padL+plotW, padT+plotH);
  graphCtx.stroke();

  graphCtx.font = '12px Segoe UI, Roboto, Arial, sans-serif';
  graphCtx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--muted') || '#889';
  var steps = 4;
  for(var s=0; s<=steps; s++){
    var val = Math.round((maxV * s)/steps);
    var y = yAt(val);
    graphCtx.beginPath();
    graphCtx.moveTo(padL, y);
    graphCtx.lineTo(padL+plotW, y);
    graphCtx.globalAlpha = 0.2;
    graphCtx.stroke();
    graphCtx.globalAlpha = 1;
    graphCtx.fillText((val||0).toLocaleString('id-ID'), 6, y+4);
  }

  for(var i=0;i<data.length;i++){
    var dlab = data[i].date.slice(-2);
    if(i===0 || i===data.length-1 || i%Math.ceil(data.length/6)===0){
      var x = xAt(i);
      graphCtx.fillText(dlab, x-6, padT+plotH+16);
    }
  }

  for (var i=1; i<data.length; i++){
    var prev = data[i-1], curr = data[i];
    var x1 = xAt(i-1), y1 = yAt(prev.value);
    var x2 = xAt(i), y2 = yAt(curr.value);
    graphCtx.strokeStyle = colorForValue(curr.value);
    graphCtx.lineWidth = 2;
    graphCtx.beginPath();
    graphCtx.moveTo(x1, y1);
    graphCtx.lineTo(x2, y2);
    graphCtx.stroke();
  }

  data.forEach(function(r,i){
    var x = xAt(i), y = yAt(r.value);
    var c = colorForValue(r.value);
    graphCtx.beginPath();
    graphCtx.arc(x, y, 4, 0, Math.PI*2);
    graphCtx.fillStyle = c;
    graphCtx.fill();
  });
}

    function saveGraphAsImage(){
      var cvs = document.getElementById('dailyGraph');
      if(!cvs) return;
      var a=document.createElement('a');
      a.href = cvs.toDataURL('image/png');
      var mp = (state.filter==='ALL') ? (new Date().toISOString().slice(0,7)) : state.filter;
      a.download = 'grafik_total_harian_'+mp+'.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    }

    function focusGraph(dateStr){
      var card = document.getElementById('graphCard');
      if(card){ card.classList.remove('pulse'); void card.offsetWidth; card.classList.add('pulse'); }
      if(card){ card.scrollIntoView({behavior:'smooth', block:'end'}); }
      // Optionally, we could highlight the exact point on next draw by storing target date.
      window.__graphFocusDate = dateStr || null;
    }


    // === Wire Grafik Simpan + resize + Tema change
    (function(){
      var sgb = document.getElementById('saveGraphBtn');
      if(sgb){ sgb.addEventListener('click', saveGraphAsImage); }
      window.addEventListener('resize', function(){ try{ drawDailyGraph(); }catch(e){} });
      var tbtn = document.getElementById('themeBtn');
      if(tbtn){
        tbtn.addEventListener('click', function(){ setTimeout(function(){ try{ drawDailyGraph(); }catch(e){} }, 50); }, { once:false });
      }
    })();

  });
})();






// === Cadangan & Pulihkan Data Sub-menu ===
document.addEventListener("click", function(e){
    if(e.target && e.target.id === "openBackupRestoreSettings"){
        var backdrop = document.getElementById('popupBackdrop');
        var modal = document.getElementById('backupRestoreSettingsModal');
        backdrop.hidden = false;
        modal.hidden = false;
        requestAnimationFrame(function(){
            backdrop.classList.add('is-visible');
            modal.classList.add('is-visible');
        });
    }
});


// === Global delegation for closing Cadangan & Pulihkan Data Jendela Dialog (returns to Pengaturan Jendela Dialog) ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-close")){
        var backupModal = e.target.closest("#backupRestoreSettingsModal");
        var backdrop = document.getElementById("popupBackdrop");
        var settingsModal = document.getElementById("settingsModal");
        if(backupModal){
            backupModal.classList.remove("is-visible");
            setTimeout(function(){
                backupModal.hidden = true;
                if(settingsModal){
                    settingsModal.hidden = false;
                    requestAnimationFrame(function(){
                        backdrop.classList.add('is-visible');
                        settingsModal.classList.add('is-visible');
                    });
          
      } else if (state.filter === 'WEEK') {
        var today = new Date();
        var day = today.getDay(); // 0=Sunday, 1=Monday
        var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
        var monday = new Date(today);
        monday.setDate(today.getDate() + diff);
        var sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        list = state.entries.filter(function(e){ return e.date >= from && e.date <= to; });

      } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
                    backdrop.hidden = true;
                }
            }, 200);
        }
    }
});


// === Pengaturan Jendela Dialog Tab Switch ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-settings-tab")){
        var target = e.target.getAttribute("data-settings-tab");
        document.querySelectorAll("#settingsContentArea .settings-tab").forEach(function(tab){
            tab.hidden = (tab.getAttribute("data-tab") !== target);
        });
    }
});




// === Open Rincian Tabel Sub-Modals without hiding main backdrop ===
document.addEventListener("click", function(e){
    function openSubModal(id){
        var modal = document.getElementById(id);
        if(modal){
            modal.hidden = false;
            requestAnimationFrame(function(){
                modal.classList.add('is-visible');
            });
        }
    }
    if(e.target && e.target.id === "openJenisPSHarianSettings"){
        openSubModal("jenisPSHarianSettingsModal");
    }
    if(e.target && e.target.id === "openJasaAksesorisSettings"){
        openSubModal("jasaAksesorisSettingsModal");
    }
    if(e.target && e.target.id === "openJenisPSSewaSettings"){
        openSubModal("jenisPSSewaSettingsModal");
    }
});

// === Tutup only sub-modals, keep main backdrop active ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-close")){
        var modal = e.target.closest(".modal");
        if(modal && modal.id !== "settingsModal"){ // avoid closing Pengaturan main Jendela Dialog here
            modal.classList.remove("is-visible");
            setTimeout(function(){
                modal.hidden = true;
            }, 200);
        }
    }
});


// === Tombol Pilih active state on sidebar buttons ===
document.querySelectorAll('.settings-sidebar .btn').forEach(function(btn){
    btn.addEventListener('click', function(){
        document.querySelectorAll('.settings-sidebar .btn').forEach(function(b){
            b.classList.remove('active');
        });
        btn.classList.add('active');
    });
});


// === Integrate active state with tab switching ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-settings-tab")){
        // Hapus active class from all sidebar buttons
        document.querySelectorAll('.settings-sidebar .btn').forEach(function(b){
            b.classList.remove('active');
        });
        // Tambah active class to clicked Tombol
        e.target.classList.add('active');
    }
});

// === Ekspor Data Sub-menu ===
document.addEventListener("click", function(e){
    if(e.target && e.target.id === "openExportDataSettings"){
        var backdrop = document.getElementById('popupBackdrop');
        var modal = document.getElementById('exportDataSettingsModal');
        backdrop.hidden = false;
        modal.hidden = false;
        requestAnimationFrame(function(){
            backdrop.classList.add('is-visible');
            modal.classList.add('is-visible');
        });
    }
    if(e.target && e.target.id === "exportCSVBtn"){
        try { exportCSV(); } catch(err){ themedAlert("Gagal ekspor CSV: " + err.message); }
    }
    if(e.target && e.target.id === "importCSVBtn"){
        var fileInput = document.getElementById('fileInput');
        if(fileInput) fileInput.click();
    }
});




// === Global delegation for closing Cadangan & Pulihkan Data Jendela Dialog (returns to Pengaturan Jendela Dialog) ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-close")){
        var backupModal = e.target.closest("#backupRestoreSettingsModal");
        var backdrop = document.getElementById("popupBackdrop");
        var settingsModal = document.getElementById("settingsModal");
        if(backupModal){
            backupModal.classList.remove("is-visible");
            setTimeout(function(){
                backupModal.hidden = true;
                if(settingsModal){
                    settingsModal.hidden = false;
                    requestAnimationFrame(function(){
                        backdrop.classList.add('is-visible');
                        settingsModal.classList.add('is-visible');
                    });
          
      } else if (state.filter === 'WEEK') {
        var today = new Date();
        var day = today.getDay(); // 0=Sunday, 1=Monday
        var diff = (day === 0 ? -6 : 1 - day); // shift to Monday
        var monday = new Date(today);
        monday.setDate(today.getDate() + diff);
        var sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        var from = new Date(monday.getTime() - monday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        var to   = new Date(sunday.getTime() - sunday.getTimezoneOffset()*60000).toISOString().slice(0,10);
        list = state.entries.filter(function(e){ return e.date >= from && e.date <= to; });

      } else if (state.filter === 'CUSTOM_MONTH' && state.customMonthValue) {
        list = state.entries.filter(function(e){
          return monthKey(e.date) === state.customMonthValue;
        });
      } else {
                    backdrop.hidden = true;
                }
            }, 200);
        }
    }
});








// === Event delegation for Cadangan & Pulihkan ===
document.addEventListener("click", function(e){
    if(e.target && e.target.id === "backupDataBtn"){
        try {
            let allData = {};
            for(let i = 0; i < localStorage.length; i++){
                let key = localStorage.key(i);
                allData[key] = localStorage.getItem(key);
            }
            let blob = new Blob([JSON.stringify(allData, null, 2)], {type: "application/json"});
            let url = URL.createObjectURL(blob);
            let a = document.createElement("a");
            a.href = url;
            let now = new Date();
            let pad = function(n){return (n<10?'0':'')+n;};
            a.download = "urban_ps_backup_" + now.getFullYear() + "-" + pad(now.getMonth()+1) + "-" + pad(now.getDate()) + ".json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        } catch(err){
            themedAlert("Gagal backup: " + err.message);
        }
    }

    if(e.target && e.target.id === "restoreDataBtn"){
        var inputEl = document.getElementById("restoreFileInput");
        if(inputEl) inputEl.click();
    }
});

document.addEventListener("change", function(e){
    if(e.target && e.target.id === "restoreFileInput"){
        let file = e.target.files[0];
        if(!file) return;
        let reader = new FileReader();
        reader.onload = function(evt){
            try {
                let data = JSON.parse(evt.target.result);
                for(let key in data){
                    localStorage.setItem(key, data[key]);
                }
                themedAlert("Data berhasil direstore. Halaman akan dimuat ulang.", {title: "Restore Berhasil"}).then(function(){
                    location.reload();
                });
            } catch(err){
                themedAlert("Gagal restore: " + err.message);
            }
        };
        reader.readAsText(file);
    }
});


// === Global delegation for closing Ekspor Data Jendela Dialog (returns to Pengaturan Jendela Dialog) ===
document.addEventListener("click", function(e){
    if(e.target && e.target.hasAttribute("data-close")){
        var exportModal = e.target.closest("#exportDataSettingsModal");
        var backdrop = document.getElementById("popupBackdrop");
        var settingsModal = document.getElementById("settingsModal");
        if(exportModal){
            exportModal.classList.remove("is-visible");
            setTimeout(function(){
                exportModal.hidden = true;
                if(settingsModal){
                    settingsModal.hidden = false;
                    requestAnimationFrame(function(){
                        backdrop.classList.add('is-visible');
                        settingsModal.classList.add('is-visible');
                    });
                }
            }, 200);
        }
    }
});


// === Focus Trap for Modals ===
function trapFocus(modal) {
  const focusableEls = modal.querySelectorAll(
    'a[href], area[href], input:not([disabled]), select:not([disabled]),' +
    'textarea:not([disabled]), button:not([disabled]), iframe, object, embed,' +
    '[tabindex]:not([tabindex="-1"]), [contenteditable]'
  );
  const firstEl = focusableEls[0];
  const lastEl = focusableEls[focusableEls.length - 1];
  modal.addEventListener("keydown", (e) => {
    if (e.key === "Tab") {
      if (e.shiftKey) {
        if (document.activeElement === firstEl) {
          e.preventDefault();
          lastEl.focus();
        }
      } else {
        if (document.activeElement === lastEl) {
          e.preventDefault();
          firstEl.focus();
        }
      }
    }
  });
}
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('transitionend', () => {
    if (!modal.hidden) trapFocus(modal);
  });
});

</script>
<script>
(function(){
  function updateDayField(){
    var dateInput = document.getElementById('date');
    var dayInput = document.getElementById('day');
    if(!dateInput || !dayInput) return;
    if(!dateInput.value){
      dayInput.value = '';
      return;
    }
    try{
      var opts = { weekday: 'long' };
      var d = new Date(dateInput.value);
      dayInput.value = d.toLocaleDateString('id-ID', opts);
    }catch(e){
      dayInput.value = '';
    }
  }
  var dateInput = document.getElementById('date');
  if(dateInput){
    dateInput.addEventListener('input', updateDayField);
    dateInput.addEventListener('change', updateDayField);
    // Init on load after slight delay to catch programmatic changes
    setTimeout(updateDayField, 50);
    // Expose globally so other code can trigger it
    window.updateDayField = updateDayField;
  }
})();
</script>
<script>
// === Jenis PS Harian Pengaturan ===
document.getElementById('addJenisPSHarianBtn').addEventListener('click', function(){
  var tbody = document.querySelector('#jenisPSHarianTable tbody');
  var tr = document.createElement('tr');
  tr.innerHTML =
    '<td><input type="text" class="input" placeholder="Nama Jenis PS"></td>' +
    '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
    '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
  tbody.appendChild(tr);
});
document.querySelector('#jenisPSHarianTable').addEventListener('click', function(e){
  if(e.target.classList.contains('remove-item')){
    e.target.closest('tr').remove();
  }
});

// === Jasa & Aksesoris Pengaturan ===
document.getElementById('addJasaAksesorisBtn').addEventListener('click', function(){
  var tbody = document.querySelector('#jasaAksesorisTable tbody');
  var tr = document.createElement('tr');
  tr.innerHTML =
    '<td><input type="text" class="input" placeholder="Nama Jasa/Aksesoris"></td>' +
    '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
    '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
  tbody.appendChild(tr);
});
document.querySelector('#jasaAksesorisTable').addEventListener('click', function(e){
  if(e.target.classList.contains('remove-item')){
    e.target.closest('tr').remove();
  }
});

// === Jenis PS Sewa Pengaturan ===
document.getElementById('addJenisPSSewaBtn').addEventListener('click', function(){
  var tbody = document.querySelector('#jenisPSSewaTable tbody');
  var tr = document.createElement('tr');
  tr.innerHTML =
    '<td><input type="text" class="input" placeholder="Jenis PS"></td>' +
    '<td><input type="number" class="input mono" placeholder="Harga"></td>' +
    '<td><button class="btn warn remove-item" type="button">Hapus</button></td>';
  tbody.appendChild(tr);
});
document.querySelector('#jenisPSSewaTable').addEventListener('click', function(e){
  if(e.target.classList.contains('remove-item')){
    e.target.closest('tr').remove();
  }
});
</script>
<script>
// === Simpan Jenis PS Harian Pengaturan ===
document.getElementById('saveJenisPSHarianBtn').addEventListener('click', function(){
  var newData = {};
  document.querySelectorAll('#jenisPSHarianTable tbody tr').forEach(function(tr){
    var name = tr.querySelector('td:nth-child(1) input').value.trim();
    var price = parseInt(tr.querySelector('td:nth-child(2) input').value) || 0;
    if(name) newData[name] = price;
  });
  localStorage.setItem('urban_ps_jenispsharian_settings', JSON.stringify(newData));
  themedAlert('Jenis PS Harian berhasil disimpan.');
});

// === Simpan Jasa & Aksesoris Pengaturan ===
document.getElementById('saveJasaAksesorisBtn').addEventListener('click', function(){
  var newData = {};
  document.querySelectorAll('#jasaAksesorisTable tbody tr').forEach(function(tr){
    var name = tr.querySelector('td:nth-child(1) input').value.trim();
    var price = parseInt(tr.querySelector('td:nth-child(2) input').value) || 0;
    if(name) newData[name] = price;
  });
  localStorage.setItem('urban_ps_jasaaksesoris_settings', JSON.stringify(newData));
  themedAlert('Jasa & Aksesoris berhasil disimpan.');
});

// === Simpan Jenis PS Sewa Pengaturan ===
document.getElementById('saveJenisPSSewaBtn').addEventListener('click', function(){
  var newData = {};
  document.querySelectorAll('#jenisPSSewaTable tbody tr').forEach(function(tr){
    var name = tr.querySelector('td:nth-child(1) input').value.trim();
    var price = parseInt(tr.querySelector('td:nth-child(2) input').value) || 0;
    if(name) newData[name] = price;
  });
  localStorage.setItem('urban_ps_jenispssewa_settings', JSON.stringify(newData));
  themedAlert('Jenis PS Sewa berhasil disimpan.');
});
</script>
<script>
// === Loaders for Pengaturan ===
function loadJenisPSHarianSettings(){
  try { return JSON.parse(localStorage.getItem('urban_ps_jenispsharian_settings') || '{}'); }
  catch(e){ return {}; }
}
function loadJasaAksesorisSettings(){
  try { return JSON.parse(localStorage.getItem('urban_ps_jasaaksesoris_settings') || '{}'); }
  catch(e){ return {}; }
}
function loadJenisPSSewaSettings(){
  try { return JSON.parse(localStorage.getItem('urban_ps_jenispssewa_settings') || '{}'); }
  catch(e){ return {}; }
}

// === Patch buildRincianRows to use Jenis PS Harian Pengaturan ===
if(typeof buildRincianRows === "function"){
  var originalBuildRincianRows = buildRincianRows;
  buildRincianRows = function(){
    rincianBody.innerHTML='';
    var psList = Object.keys(loadJenisPSHarianSettings());
    if(psList.length === 0) psList = ["PS3","PS4"]; // fallback
    for(var i=1;i<=10;i++){
      var tr=document.createElement('tr');
      tr.innerHTML = '<td>'+i+'</td>' +
        '<td><select class="select mini r-jenis"><option value="">-</option>'+psList.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
        '<td><input type="time" class="input mini r-jam"/></td>' +
        '<td><input type="number" min="0" step="0.5" placeholder="0" class="input mono mini r-jumlah"/></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini rincian-harga r-harga"/></td>';
      rincianBody.appendChild(tr);
    }
    wireRincianEvents();
  }
}

// === Patch buildJasa2x5 to use Jasa & Aksesoris Pengaturan ===
if(typeof buildJasa2x5 === "function"){
  var originalBuildJasa2x5 = buildJasa2x5;
  buildJasa2x5 = function(){
    var tb=$('#jasaTable2x5 tbody'); tb.innerHTML='';
    var jasaList = Object.keys(loadJasaAksesorisSettings());
    if(jasaList.length === 0) jasaList = ["Isi Game","Stik & Aksesoris","Upgrade HEN","Aksesoris"];
    for(var i=0;i<5;i++){
      var tr=document.createElement('tr');
      tr.innerHTML = '<td>'+ (i+1) +'</td>' +
        '<td><select class="select mini jasa-type"><option value="">-</option>'+jasaList.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
        '<td><input type="text" class="input mini jasa-note" placeholder="keterangan (opsional)"/></td>' +
        '<td><input type="number" min="0" step="100" placeholder="0" class="input mono mini jasa-price"/></td>';
      tb.appendChild(tr);
    }
    $all('.jasa-price').forEach(function(inp){ inp.addEventListener('input', sumJasa2x5); });
  }
}

// === Patch buildSewa3x10 to use Jenis PS Sewa Pengaturan ===
if(typeof buildSewa3x10 === "function"){
  var originalBuildSewa3x10 = buildSewa3x10;
  buildSewa3x10 = function(){
    var tb=$('#sewaTable3x10 tbody'); tb.innerHTML='';
    var sewaList = Object.keys(loadJenisPSSewaSettings());
    if(sewaList.length === 0) sewaList = ["PS3","PS4","PS3 + TV","PS4 + TV","PS3 Portable","PS4 Portable","Hanya TV"];
    for(var i=0;i<5;i++){
      var tr=document.createElement('tr');
      tr.innerHTML = '<td>'+(i+1)+'</td>' +
        '<td><select class="select mini sewa-jenis"><option value="">-</option>'+sewaList.map(x=>'<option>'+x+'</option>').join('')+'</select></td>' +
        '<td><div style="display:grid;grid-template-columns:1fr 1fr;gap: var(--space-1)">' +
            '<select class="select mini sewa-durasi"><option value="">-</option><option value="12JAM">12 JAM</option><option value="1HARI">1 HARI</option><option value="2HARI">2 HARI</option><option value="3HARI">3 HARI</option></select>' +
            '<input type="text" placeholder="Isi Sendiri" class="input mini sewa-manual"/></div></td>' +
        '<td><input type="text" placeholder="note (optional)" class="input mini sewa-lama-note"/></td><td><input type="number" min="0" step="1000" placeholder="0" class="input mono mini sewa-harga"/></td>';
      tb.appendChild(tr);
    }
    $all('#sewaTable3x10 tbody tr').forEach(function(tr){
      var selJ=tr.querySelector('.sewa-jenis'); var selD=tr.querySelector('.sewa-durasi'); var inM=tr.querySelector('.sewa-manual'); var inH=tr.querySelector('.sewa-harga');
      function recalc(){
        var manualVal = (inM.value || '').trim();
        if(manualVal){ return; }
        var jam = hoursFromDurasiSelect(selD.value, '');
        var price = calcSewaPrice(selJ.value, jam);
        if(price>0){ inH.value = price; } else { inH.value=''; }
        sumSewa3x10();
      }
      selJ.addEventListener('change', recalc); selD.addEventListener('change', recalc); inM.addEventListener('input', recalc); inH.addEventListener('input', sumSewa3x10);
    });
  }
}
</script>
<script>
// Default Jenis PS
const DEFAULT_PS = {
  "PS3": 5000,
  "PS4": 7000
};

// Load setting Jenis PS Harian + gabung dengan default
function loadJenisPSHarianSettings(){
  try { 
    var custom = JSON.parse(localStorage.getItem('urban_ps_jenispsharian_settings') || '{}'); 
    return Object.assign({}, DEFAULT_PS, custom);
  }
  catch(e){ 
    return Object.assign({}, DEFAULT_PS);
  }
}

// Refresh dropdown Jenis PS
function refreshJenisPSDropdowns(){
  var psList = Object.keys(loadJenisPSHarianSettings());
  document.querySelectorAll("select.r-jenis").forEach(function(sel){
    var val = sel.value; // simpan pilihan lama
    sel.innerHTML = '<option value="">-</option>' + psList.map(x=>'<option>'+x+'</option>').join('');
    if(val && psList.includes(val)) sel.value = val;
  });
}

// Auto refresh setelah halaman load
document.addEventListener("DOMContentLoaded", function(){
  refreshJenisPSDropdowns();
});

// Patch tombol Simpan di Jendela Dialog Jenis PS Harian
(function(){
  var btn = document.getElementById('saveJenisPSHarianBtn');
  if(btn){
    btn.addEventListener('click', function(){
      setTimeout(function(){
        if(typeof buildRincianRows === 'function'){
          buildRincianRows();
        }
        refreshJenisPSDropdowns();
        if(typeof sumRincian === 'function'){
          sumRincian();
        }
      }, 200);
    });
  }
})();
</script>
<script>
// === Reset Pengaturan ===
document.addEventListener("DOMContentLoaded", function(){
  var btn = document.getElementById('resetSettingsBtn');
  if(btn){
    btn.addEventListener('click', function(e){
      e.preventDefault();
      if(confirm("Yakin ingin reset semua setting? Data transaksi tidak akan terhapus.")){
        localStorage.removeItem('urban_ps_jenispsharian_settings');
        localStorage.removeItem('urban_item_settings');
        // tambahkan key setting lain jika ada
        themedAlert("âœ… Semua setting berhasil direset.");
        if(typeof buildRincianRows === 'function') buildRincianRows();
        if(typeof refreshJenisPSDropdowns === 'function') refreshJenisPSDropdowns();
      }
    });
  }
});
</script>
<script>
// === Manual Theme Toggle ===
const themeBtn = document.getElementById('themeBtn');
function applyTheme(saved) {
  if (saved === 'dark') {
    document.body.classList.add('dark-theme');
    themeBtn.innerHTML = '<span class="emoji">â˜€ï¸</span> Terang';
  } else {
    document.body.classList.remove('dark-theme');
    themeBtn.innerHTML = '<span class="emoji">ðŸŒ™</span> Gelap';
  }
}
// Load theme on startup
const savedTheme = localStorage.getItem('theme');
applyTheme(savedTheme);

// Toggle on button click
themeBtn.addEventListener('click', () => {
  const isDark = document.body.classList.toggle('dark-theme');
  const mode = isDark ? 'dark' : 'light';
  localStorage.setItem('theme', mode);
  applyTheme(mode);
});
</script>
<script>
function syncBodyClassToTheme() {
  var t = getTheme();
  document.body.classList.toggle('dark-theme', t !== 'light');
}

// Patch setTheme to auto sync body class
(function(){
  var origSetTheme = setTheme;
  setTheme = function(t){
    origSetTheme(t);
    syncBodyClassToTheme();
  };
})();

document.addEventListener('DOMContentLoaded', syncBodyClassToTheme);
</script>
<style id="header-buttons-ripple">
/* Ripple container */
.header .btn {
  position: relative;
  overflow: hidden;
}

/* Ripple effect */
.header .btn .ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple-animation 600ms linear;
  background-color: rgba(255, 255, 255, 0.6);
  pointer-events: none;
}
@keyframes ripple-animation {
  to {
    transform: scale(4);
    opacity: 0;
  }
}
</style>
<script>
// Ripple effect script
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.header .btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      const circle = document.createElement("span");
      circle.classList.add("ripple");
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      circle.style.width = circle.style.height = size + "px";
      circle.style.left = e.clientX - rect.left - size / 2 + "px";
      circle.style.top = e.clientY - rect.top - size / 2 + "px";
      this.appendChild(circle);
      setTimeout(() => circle.remove(), 600);
    });
  });
});
</script>
<style id="header-buttons-deepblue-ripple">
/* Dark Mode Buttons: Deeper Blue */
html:not([data-theme="light"]) .header .btn {
  background: #082567 !important;  /* navy deep blue */
  border: 1px solid #0d47a1 !important;
  color: #fff !important;
  box-shadow: 0 0 8px rgba(13,71,161,0.5) !important;
}
html:not([data-theme="light"]) .header .btn:hover {
  background: #0d47a1 !important;  /* slightly lighter */
  box-shadow: 0 0 12px rgba(21,101,192,0.7) !important;
}

/* Ripple effect */
.header .btn {
  position: relative;
  overflow: hidden;
}
.header .btn .ripple {
  position: absolute;
  border-radius: 50%;
  transform: scale(0);
  animation: ripple-animation 600ms linear;
  pointer-events: none;
}
html[data-theme="light"] .header .btn .ripple {
  background-color: rgba(255, 255, 255, 0.6);
}
html:not([data-theme="light"]) .header .btn .ripple {
  background-color: rgba(21, 101, 192, 0.6); /* blue ripple in dark mode */
}
@keyframes ripple-animation {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

/* Recap flex */
.recap-flex {
  display: flex;
  flex-direction: column;   /* default: stack (mobile) */
  gap: 8px;
  margin-top: 8px;
}
.recap-flex .recap-item {
  display: flex;
  justify-content: space-between;
  padding: 6px 12px;
  border: 1px solid var(--ring);
  border-radius: var(--radius);
  background: var(--card2);
  font-size: 14px;
}
.recap-flex .recap-item.total {
  background: var(--accent);
  color: #fff;
  font-weight: bold;
}

/* Desktop: jadikan horizontal */
@media (min-width: 768px) {
  .recap-flex {
    flex-direction: row;   /* sejajar */
  }
  .recap-flex .recap-item {
    flex: 1;               /* biar rata semua */
  }
}


/* Desktop: recap flex horizontal dengan total di baris kedua */
@media (min-width: 768px) {
  .recap-flex {
    flex-direction: row;
    flex-wrap: wrap;       /* bisa turun ke baris kedua */
  }
  .recap-flex .recap-item {
    flex: 1;
  }
  .recap-flex .recap-item.total {
    flex: 100%;            /* total full width di baris kedua */
    text-align: right;     /* nilai rata kanan */
    justify-content: space-between;
  }
  .recap-flex .recap-item span:last-child {
    margin-left: auto;     /* paksa angka ke kanan */
  }
}

</style>
<script>
// Ripple effect script (re-applied for consistency)
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.header .btn').forEach(btn => {
    btn.addEventListener('click', function(e) {
      const circle = document.createElement("span");
      circle.classList.add("ripple");
      const rect = this.getBoundingClientRect();
      const size = Math.max(rect.width, rect.height);
      circle.style.width = circle.style.height = size + "px";
      circle.style.left = e.clientX - rect.left - size / 2 + "px";
      circle.style.top = e.clientY - rect.top - size / 2 + "px";
      this.appendChild(circle);
      setTimeout(() => circle.remove(), 600);
    });
  });
});
</script>
<script>
// Scroll ke tabel saat klik recap
document.querySelectorAll('.recap-item[data-target]').forEach(item => {
  item.addEventListener('click', () => {
    const targetSel = item.getAttribute('data-target');
    const target = document.querySelector(targetSel);
    if (target) {
      target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
});

// Highlight update tiap kali nilai berubah
function updateRecapHighlight(id) {
  const el = document.getElementById(id);
  if (!el) return;
  const parent = el.closest('.recap-item');
  if (parent) {
    parent.classList.add('updated');
    setTimeout(() => parent.classList.remove('updated'), 800);
  }
}

// Override updateRecap dengan highlight
const originalUpdateRecap = window.updateRecap;
window.updateRecap = function(){
  if(typeof originalUpdateRecap === 'function'){ originalUpdateRecap(); }
  ['recapHarian','recapJajanan','recapJasa','recapSewa','grandTotal'].forEach(updateRecapHighlight);
};
</script></body>
</html>